import{u as E,a as X}from"./index-0d084998.js";import{_ as O,u as Y}from"./useProjects-d95457a2.js";import{_ as q}from"./ProjectStatusBadge.vue_vue_type_script_setup_true_lang-4be0592d.js";import{d as S,f as d,a as m,g as D,w as c,c as C,x as I,F as z,j as Z,h as o,b as u,t as k,e as N,i as F,u as i,$ as A,H as T,_ as L,r as U,C as ee}from"./index-baf31f29.js";import{d as te}from"./index-b5bcfade.js";import{u as M}from"./useUsers-c6c8a528.js";import{u as oe}from"./useModal-cbf776bb.js";import{u as ae}from"./useToast-3b397679.js";import"./utils-b2fc192b.js";const le={class:"text-[var(--va-secondary)]"},se={class:"flex flex-col items-center gap-4 grow"},ne={class:"va-h4 text-center self-stretch overflow-hidden line-clamp-2 text-ellipsis"},re=u("span",{class:"text-[var(--va-secondary)]"},"Owner: ",-1),ie={class:"flex justify-between"},de={key:1,class:"p-4 flex justify-center items-center text-[var(--va-secondary)]"},ce=S({__name:"ProjectCards",props:{projects:{type:Array,required:!0},loading:{type:Boolean,required:!0}},emits:["edit","delete"],setup(b){const w=g=>{const f=["primary","#FFD43A","#ADFF00","#262824","danger"],r=g.charCodeAt(0)%f.length;return f[r]};return(g,f)=>{const r=d("VaAvatarGroup"),$=d("VaDivider"),y=d("VaButton"),V=d("VaCardContent"),_=d("VaCard"),n=d("VaInnerLoading");return b.projects.length>0||b.loading?(m(),D(n,{key:0,loading:b.loading,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 min-h-[4rem]"},{default:c(()=>[(m(!0),C(z,null,I(b.projects,e=>(m(),D(_,{key:e.project_name,style:Z({"--va-card-outlined-border":"1px solid var(--va-background-element)"}),outlined:""},{default:c(()=>[o(V,{class:"flex flex-col h-full"},{default:c(()=>[u("div",le,k(e.creation_date),1),u("div",se,[u("h4",ne,k(e.project_name),1),u("p",null,[re,u("span",null,k(e.project_owner.fullname),1)]),o(r,{class:"my-4",options:e.team.map(l=>({label:l.fullname,src:l.avatar,fallbackText:l.fullname[0],color:w(l.fullname)})),max:5},null,8,["options"]),o(q,{status:e.status},null,8,["status"])]),o($,{class:"my-6"}),u("div",ie,[o(y,{preset:"secondary",icon:"mso-edit",color:"secondary",onClick:l=>g.$emit("edit",e)},null,8,["onClick"]),o(y,{preset:"secondary",icon:"mso-delete",color:"danger",onClick:l=>g.$emit("delete",e)},null,8,["onClick"])])]),_:2},1024)]),_:2},1032,["style"]))),128))]),_:1},8,["loading"])):(m(),C("div",de,"No projects"))}}}),ue={class:"ellipsis max-w-[230px] lg:max-w-[450px]"},pe={class:"flex items-center gap-2 ellipsis max-w-[230px]"},me={class:"flex gap-2 justify-end"},ge={class:"flex flex-col-reverse md:flex-row gap-2 justify-between items-center py-2"},ve={key:0,class:"flex"},fe=S({__name:"ProjectsTable",props:{projects:{type:Array,required:!0},loading:{type:Boolean,required:!0},sortBy:{type:Object,required:!0},sortingOrder:{type:Object,required:!0},pagination:{type:Object,required:!0}},emits:["edit","delete"],setup(b,{emit:w}){const g=te([{label:"Project name",key:"project_name",sortable:!0},{label:"Project owner",key:"project_owner",sortable:!0},{label:"Team",key:"team",sortable:!0},{label:"Status",key:"status",sortable:!0},{label:"Creation Date",key:"creation_date",sortable:!0},{label:" ",key:"actions"}]),f=b,r=w,$=n=>{const e=["primary","#FFD43A","#ADFF00","#262824","danger"],l=n.charCodeAt(0)%e.length;return e[l]},y=E(f,"sortBy",r),V=E(f,"sortingOrder",r),_=N(()=>Math.ceil(f.pagination.total/f.pagination.perPage));return(n,e)=>{const l=d("VaAvatarGroup"),s=d("VaButton"),P=d("VaDataTable"),h=d("VaSelect"),B=d("VaPagination");return m(),C("div",null,[o(P,{"sort-by":i(y),"onUpdate:sortBy":e[0]||(e[0]=a=>A(y)?y.value=a:null),"sorting-order":i(V),"onUpdate:sortingOrder":e[1]||(e[1]=a=>A(V)?V.value=a:null),items:b.projects,columns:i(g),loading:b.loading},{"cell(project_name)":c(({rowData:a})=>[u("div",ue,k(a.project_name),1)]),"cell(project_owner)":c(({rowData:a})=>[u("div",pe,[o(O,{user:a.project_owner,size:"small"},null,8,["user"]),F(" "+k(a.project_owner.fullname),1)])]),"cell(team)":c(({rowData:a})=>[o(l,{size:"small",options:a.team.map(j=>({label:j.fullname,src:j.avatar,fallbackText:j.fullname[0],color:$(j.fullname)})),max:5},null,8,["options"])]),"cell(status)":c(({rowData:a})=>[o(q,{status:a.status},null,8,["status"])]),"cell(actions)":c(({rowData:a})=>[u("div",me,[o(s,{preset:"primary",size:"small",color:"primary",icon:"mso-edit","aria-label":"Edit project",onClick:j=>n.$emit("edit",a)},null,8,["onClick"]),o(s,{preset:"primary",size:"small",icon:"mso-delete",color:"danger","aria-label":"Delete project",onClick:j=>n.$emit("delete",a)},null,8,["onClick"])])]),_:1},8,["sort-by","sorting-order","items","columns","loading"]),u("div",ge,[u("div",null,[u("b",null,k(n.$props.pagination.total)+" results.",1),F(" Results per page "),o(h,{modelValue:n.$props.pagination.perPage,"onUpdate:modelValue":e[2]||(e[2]=a=>n.$props.pagination.perPage=a),class:"!w-20",options:[10,50,100]},null,8,["modelValue"])]),_.value>1?(m(),C("div",ve,[o(s,{preset:"secondary",icon:"va-arrow-left","aria-label":"Previous page",disabled:n.$props.pagination.page===1,onClick:e[3]||(e[3]=a=>n.$props.pagination.page--)},null,8,["disabled"]),o(s,{class:"mr-2",preset:"secondary",icon:"va-arrow-right","aria-label":"Next page",disabled:n.$props.pagination.page===_.value,onClick:e[4]||(e[4]=a=>n.$props.pagination.page++)},null,8,["disabled"]),o(B,{modelValue:n.$props.pagination.page,"onUpdate:modelValue":e[5]||(e[5]=a=>n.$props.pagination.page=a),"buttons-preset":"secondary",pages:_.value,"visible-pages":5,"boundary-links":!1,"direction-links":!1},null,8,["modelValue","pages"])])):T("",!0)])])}}});const _e=L(fe,[["__scopeId","data-v-d2c1350b"]]),ye={class:"flex justify-end flex-col-reverse sm:flex-row mt-4 gap-2"},be=S({__name:"EditProjectForm",props:{project:{},saveButtonLabel:{}},emits:["save","close"],setup(b,{expose:w}){const g=b,f={project_name:"",project_owner:void 0,team:[],status:void 0},r=U({...f}),$=N(()=>Object.keys(r.value).some(l=>{var s;return l==="team"?!1:r.value[l]!==((s=g.project??f)==null?void 0:s[l])}));w({isFormHasUnsavedChanges:$}),ee(()=>g.project,()=>{g.project&&(r.value={...g.project,project_owner:g.project.project_owner})},{immediate:!0});const y=l=>!!l||"This field is required",{users:V,filters:_}=M({pagination:U({page:1,perPage:100,total:10})}),{users:n,filters:e}=M({pagination:U({page:1,perPage:100,total:10})});return(l,s)=>{const P=d("VaInput"),h=d("VaSelect"),B=d("VaButton"),a=d("VaForm");return m(),D(a,{class:"flex flex-col gap-2"},{default:c(({validate:j})=>[o(P,{modelValue:r.value.project_name,"onUpdate:modelValue":s[0]||(s[0]=t=>r.value.project_name=t),label:"Project name",rules:[y]},null,8,["modelValue","rules"]),o(h,{modelValue:r.value.project_owner,"onUpdate:modelValue":s[1]||(s[1]=t=>r.value.project_owner=t),search:i(e).search,"onUpdate:search":s[2]||(s[2]=t=>i(e).search=t),searchable:"",label:"Owner","text-by":"fullname","track-by":"id",rules:[y],options:i(n)},{content:c(({value:t})=>[t?(m(),C("div",{key:t.id,class:"flex items-center gap-1 mr-4"},[o(O,{user:t,size:"18px"},null,8,["user"]),F(" "+k(t.fullname),1)])):T("",!0)]),_:1},8,["modelValue","search","rules","options"]),o(h,{modelValue:r.value.team,"onUpdate:modelValue":s[3]||(s[3]=t=>r.value.team=t),search:i(_).search,"onUpdate:search":s[4]||(s[4]=t=>i(_).search=t),label:"Team","text-by":"fullname","track-by":"id",multiple:"",rules:[t=>"length"in t&&t.length>0||"This field is required"],options:i(V),"max-visible-options":l.$vaBreakpoint.mdUp?3:1},{content:c(({valueArray:t})=>[t?(m(!0),C(z,{key:0},I(t,(p,v)=>(m(),C("div",{key:p.id,class:"flex items-center gap-1 mr-2"},[o(O,{user:p,size:"18px"},null,8,["user"]),F(" "+k(p.fullname)+k(v<t.length-1?",":""),1)]))),128)):T("",!0)]),_:1},8,["modelValue","search","rules","options","max-visible-options"]),o(h,{modelValue:r.value.status,"onUpdate:modelValue":s[5]||(s[5]=t=>r.value.status=t),label:"Status",rules:[y],"track-by":"value","value-by":"value",options:[{text:"In progress",value:"in progress"},{text:"Archived",value:"archived"},{text:"Completed",value:"completed"},{text:"Important",value:"important"}]},{content:c(({value:t})=>[t?(m(),D(q,{key:0,status:t.value},null,8,["status"])):T("",!0)]),_:1},8,["modelValue","rules"]),u("div",ye,[o(B,{preset:"secondary",color:"secondary",onClick:s[6]||(s[6]=t=>l.$emit("close"))},{default:c(()=>[F("Cancel")]),_:1}),o(B,{onClick:t=>j()&&l.$emit("save",r.value)},{default:c(()=>[F(k(l.saveButtonLabel),1)]),_:2},1032,["onClick"])])]),_:1})}}});const Ve=L(be,[["__scopeId","data-v-7e9dc5ae"]]),je=u("h1",{class:"page-title"},"Projects",-1),xe={class:"flex flex-col md:flex-row gap-2 mb-2 justify-between"},we={class:"flex flex-col md:flex-row gap-2 justify-start"},ke={key:0,class:"va-h5 mb-4"},Ce={key:1,class:"va-h5 mb-4"},Se=S({__name:"ProjectsPage",setup(b){const w=X("projects-view",!0),{projects:g,update:f,add:r,isLoading:$,remove:y,pagination:V,sorting:_}=Y(),n=U(null),e=U(!1),l=p=>{n.value=p,e.value=!0},s=()=>{n.value=null,e.value=!0},{init:P}=ae(),h=async p=>{e.value=!1,"id"in p?(await f(p),P({message:"Project updated",color:"success"})):(await r(p),P({message:"Project created",color:"success"}))},{confirm:B}=oe(),a=async p=>{await B({title:"Delete project",message:`Are you sure you want to delete project "${p.project_name}"?`,okText:"Delete",size:"small",maxWidth:"380px"})&&(await y(p),P({message:"Project deleted",color:"success"}))},j=U(),t=async p=>{j.value.isFormHasUnsavedChanges?await B({maxWidth:"380px",message:"Form has unsaved changes. Are you sure you want to close it?",size:"small"})&&p():p()};return(p,v)=>{const G=d("VaButtonToggle"),R=d("VaButton"),H=d("VaCardContent"),W=d("VaModal"),J=d("VaCard");return m(),C(z,null,[je,o(J,null,{default:c(()=>[o(H,null,{default:c(()=>[u("div",xe,[u("div",we,[o(G,{modelValue:i(w),"onUpdate:modelValue":v[0]||(v[0]=x=>A(w)?w.value=x:null),color:"background-element","border-color":"background-element",options:[{label:"Cards",value:!0},{label:"Table",value:!1}]},null,8,["modelValue"])]),o(R,{icon:"add",onClick:s},{default:c(()=>[F("Project")]),_:1})]),i(w)?(m(),D(ce,{key:0,projects:i(g),loading:i($),onEdit:l,onDelete:a},null,8,["projects","loading"])):(m(),D(_e,{key:1,"sort-by":i(_).sortBy,"onUpdate:sortBy":v[1]||(v[1]=x=>i(_).sortBy=x),"sorting-order":i(_).sortingOrder,"onUpdate:sortingOrder":v[2]||(v[2]=x=>i(_).sortingOrder=x),pagination:i(V),"onUpdate:pagination":v[3]||(v[3]=x=>A(V)?V.value=x:null),projects:i(g),loading:i($),onEdit:l,onDelete:a},null,8,["sort-by","sorting-order","pagination","projects","loading"]))]),_:1}),o(W,{modelValue:e.value,"onUpdate:modelValue":v[4]||(v[4]=x=>e.value=x),size:"small","mobile-fullscreen":"","close-button":"",stateful:"","hide-default-actions":"","before-cancel":t},{default:c(({cancel:x,ok:K})=>[n.value===null?(m(),C("h1",ke,"Add project")):(m(),C("h1",Ce,"Edit project")),o(Ve,{ref_key:"editFormRef",ref:j,project:n.value,"save-button-label":n.value===null?"Add":"Save",onClose:x,onSave:Q=>{h(Q),K()}},null,8,["project","save-button-label","onClose","onSave"])]),_:1},8,["modelValue"])]),_:1})],64)}}});export{Se as default};
//# sourceMappingURL=ProjectsPage-8d6b8c5c.js.map
