import{d as Z,w as ee}from"./index-f39d5fd0.js";import{u as G}from"./useModal-f5bb3c48.js";import{d as P,f as v,a as y,g as E,X as ae,e as J,c as $,h as t,w as h,b as n,t as N,i as A,u as f,Y as W,H as Y,F,_ as le,r as _,C as q,R as te,x as H}from"./index-57cdd299.js";import{u as X}from"./index-21e81370.js";import{u as se}from"./useForm-ba2fea1b.js";import{v as D}from"./utils-b2fc192b.js";import{a as B}from"./api-5d10a652.js";import{u as oe}from"./useToast-6304b3bc.js";const K=P({__name:"TherapistAvatar",props:{therapist:{type:Object,required:!0},size:{type:String,default:"medium"}},setup(b){const p=d=>{const i=["primary","#FFD43A","#ADFF00","#262824","danger"],r=d.charCodeAt(0)%i.length;return i[r]},x=d=>d?d.startsWith("http")||d.startsWith("blob:"):!1;return(d,i)=>{const r=v("VaAvatar");return y(),E(r,{size:b.size,src:x(b.therapist.coverImageUrl)?b.therapist.coverImageUrl:"","fallback-text":b.therapist.name[0],color:p(b.therapist.name)},null,8,["size","src","fallback-text","color"])}}}),re={class:"font-semibold"},ne={class:"flex items-center gap-2 max-w-[230px] ellipsis"},ie={class:"text-center font-mono"},ue={class:"flex gap-2 justify-end"},de={class:"flex flex-col-reverse md:flex-row gap-2 justify-between items-center py-2"},me={key:0,class:"flex"},pe=P({__name:"TherapistsTable",props:{therapists:{type:Array,required:!0},loading:{type:Boolean,default:!1},pagination:{type:Object,required:!0},sortBy:{type:String,required:!0},sortingOrder:{type:String,required:!0}},emits:["edit-therapist","delete-therapist","update:sortBy","update:sortingOrder"],setup(b,{emit:p}){const x=Z([{label:"Number",key:"number",sortable:!0},{label:"Name",key:"name",sortable:!0},{label:"Sort Order",key:"sortOrder",sortable:!0},{label:" ",key:"actions",align:"right"}]),d=b,i=p,r=ae(d,"therapists"),e=X(d,"sortBy",i),w=X(d,"sortingOrder",i),s=J(()=>Math.ceil(d.pagination.total/d.pagination.perPage)),{confirm:c}=G(),C=async m=>{await c({title:"Delete therapist",message:`Are you sure you want to delete ${m.name}?`,okText:"Delete",cancelText:"Cancel",size:"small",maxWidth:"380px"})&&i("delete-therapist",m)};return(m,g)=>{const U=v("VaButton"),T=v("VaDataTable"),I=v("VaSelect"),o=v("VaPagination");return y(),$(F,null,[t(T,{"sort-by":f(e),"onUpdate:sortBy":g[0]||(g[0]=a=>W(e)?e.value=a:null),"sorting-order":f(w),"onUpdate:sortingOrder":g[1]||(g[1]=a=>W(w)?w.value=a:null),columns:f(x),items:r.value,loading:m.$props.loading},{"cell(number)":h(({rowData:a})=>[n("div",re,N(a.number),1)]),"cell(name)":h(({rowData:a})=>[n("div",ne,[t(K,{therapist:a,size:"small"},null,8,["therapist"]),A(" "+N(a.name),1)])]),"cell(sortOrder)":h(({rowData:a})=>[n("div",ie,N(a.sortOrder),1)]),"cell(actions)":h(({rowData:a})=>[n("div",ue,[t(U,{preset:"primary",size:"small",icon:"mso-edit","aria-label":"Edit therapist",onClick:u=>m.$emit("edit-therapist",a)},null,8,["onClick"]),t(U,{preset:"primary",size:"small",icon:"mso-delete",color:"danger","aria-label":"Delete therapist",onClick:u=>C(a)},null,8,["onClick"])])]),_:1},8,["sort-by","sorting-order","columns","items","loading"]),n("div",de,[n("div",null,[n("b",null,N(m.$props.pagination.total)+" results.",1),A(" Results per page "),t(I,{modelValue:m.$props.pagination.perPage,"onUpdate:modelValue":g[2]||(g[2]=a=>m.$props.pagination.perPage=a),class:"!w-20",options:[10,50,100]},null,8,["modelValue"])]),s.value>1?(y(),$("div",me,[t(U,{preset:"secondary",icon:"va-arrow-left","aria-label":"Previous page",disabled:m.$props.pagination.page===1,onClick:g[3]||(g[3]=a=>m.$props.pagination.page--)},null,8,["disabled"]),t(U,{class:"mr-2",preset:"secondary",icon:"va-arrow-right","aria-label":"Next page",disabled:m.$props.pagination.page===s.value,onClick:g[4]||(g[4]=a=>m.$props.pagination.page++)},null,8,["disabled"]),t(o,{modelValue:m.$props.pagination.page,"onUpdate:modelValue":g[5]||(g[5]=a=>m.$props.pagination.page=a),"buttons-preset":"secondary",pages:s.value,"visible-pages":5,"boundary-links":!1,"direction-links":!1},null,8,["modelValue","pages"])])):Y("",!0)])],64)}}});const ce=le(pe,[["__scopeId","data-v-dd0884f1"]]),ve=()=>_({page:1,perPage:10,total:0}),ge=()=>_({sortBy:"name",sortingOrder:null}),fe=()=>_({isActive:!0,search:""}),Q=b=>{const p=_(!1),x=_([]),{filters:d=fe(),sorting:i=ge(),pagination:r=ve()}=b||{},e=async()=>{p.value=!0;const{data:s}=await B.getTherapists({isActive:d.value.isActive,offset:r.value.page*r.value.perPage-r.value.perPage,limit:r.value.perPage});x.value=s.data,console.log(s,"data"),w(()=>{r.value={page:r.value.page,perPage:r.value.perPage,total:s.total||s.data.length}}),p.value=!1},{ignoreUpdates:w}=ee([r,i],e,{deep:!0});return q(d,()=>{r.value.page=1,e()},{deep:!0}),e(),{isLoading:p,filters:d,sorting:i,pagination:r,therapists:x,fetch:e,async add(s){p.value=!0;try{await B.axiosInstance.post("/plan/dragon-massage/therapist",s),await e()}catch(c){throw console.error("Error adding therapist:",c),c}finally{p.value=!1}},async update(s){p.value=!0;const{id:c,...C}=s;await B.axiosInstance.put(`/plan/dragon-massage/therapist/${c}`,C),await e(),p.value=!1},async remove(s){p.value=!0,await B.axiosInstance.post("/plan/dragon-massage/therapist",s),await e(),p.value=!1},async uploadImages(s){try{return(await B.uploadTherapistImages(s)).data.data.imageNames}catch(c){throw console.error("Error uploading images:",c),c}}}},he={class:"self-stretch flex-col justify-start items-start gap-4 flex"},be={class:"flex gap-4 flex-col sm:flex-row w-full"},Ve={class:"flex gap-4 flex-col sm:flex-row w-full"},we={class:"flex gap-4 flex-col sm:flex-row w-full"},ye={class:"flex gap-4 flex-col sm:flex-row w-full"},_e={class:"w-full"},xe=n("label",{class:"va-input-label"},"相片集",-1),ke={key:0,class:"flex flex-wrap gap-2 mt-4"},Ue=["src","alt"],$e=["src","alt"],Ce={class:"flex gap-4 w-full"},Te={class:"flex items-center w-1/2 mt-4"},Ae={class:"flex gap-4 flex-col sm:flex-row w-full"},Ne={class:"flex gap-2 flex-col-reverse items-stretch justify-end w-full sm:flex-row sm:items-center"},Ie=P({__name:"EditTherapistForm",props:{therapist:{type:Object,default:null},saveButtonLabel:{type:String,default:"Save"}},emits:["close","save"],setup(b,{expose:p,emit:x}){const{uploadImages:d}=Q(),i=b,r={id:-1,number:0,name:"",coverImage:"",images:[],height:0,weight:0,birthYear:0,description:"",technicalLevel:"",removal:"",serviceMedal:"",note:"",recommendRank:"",paymentNote:"",sortOrder:0,isActive:!0,createdAt:"",updatedAt:"",deletedAt:"",coverImageUrl:"",imageUrls:[]},e=_({...r}),w=J(()=>Object.keys(e.value).some(o=>{var a;return o==="avatar"||o==="images"?!1:e.value[o]!==((a=i.therapist??r)==null?void 0:a[o])}));p({isFormHasUnsavedChanges:w}),q(()=>i.therapist,()=>{i.therapist&&(e.value={...i.therapist})},{immediate:!0});const s=_(),c=_([]),C=o=>URL.createObjectURL(o),m=o=>URL.createObjectURL(o),g=o=>{e.value.imageUrls&&e.value.imageUrls.splice(o,1),e.value.images&&e.value.images.splice(o,1)};q(s,o=>{e.value.coverImageUrl=o?C(o):""});const U=se("add-therapist-form"),T=x,I=async()=>{if(U.validate())if(s.value&&await d([s.value]).then(o=>{e.value.coverImage=o[0]}),c.value.length>0&&await d(c.value).then(o=>{e.value.images||(e.value.images=[]),e.value.images.push(...o)}),i.therapist){const o={id:i.therapist.id,number:Number(e.value.number)||0,name:e.value.name,coverImage:e.value.coverImage,images:e.value.images,height:e.value.height?Number(e.value.height):0,weight:e.value.weight?Number(e.value.weight):0,birthYear:e.value.birthYear?Number(e.value.birthYear):0,description:e.value.description,technicalLevel:e.value.technicalLevel,removal:e.value.removal,serviceMedal:e.value.serviceMedal,note:e.value.note,recommendRank:e.value.recommendRank,paymentNote:e.value.paymentNote,sortOrder:Number(e.value.sortOrder)||0,isActive:e.value.isActive};T("save",o)}else{const o={number:Number(e.value.number)||0,name:e.value.name,coverImage:e.value.coverImage,images:e.value.images,height:e.value.height?Number(e.value.height):0,weight:e.value.weight?Number(e.value.weight):0,birthYear:e.value.birthYear?Number(e.value.birthYear):0,description:e.value.description,technicalLevel:e.value.technicalLevel,removal:e.value.removal,serviceMedal:e.value.serviceMedal,note:e.value.note,recommendRank:e.value.recommendRank,paymentNote:e.value.paymentNote,sortOrder:Number(e.value.sortOrder)||0,isActive:e.value.isActive};T("save",o)}};return(o,a)=>{const u=v("VaButton"),R=v("VaFileUpload"),V=v("VaInput"),S=v("VaCheckbox"),O=v("VaTextarea"),z=v("VaForm");return y(),E(z,{ref:"add-therapist-form",class:"flex-col justify-start items-start gap-4 inline-flex w-full"},{default:h(({isValid:L})=>{var M;return[t(R,{modelValue:s.value,"onUpdate:modelValue":a[1]||(a[1]=l=>s.value=l),type:"single","hide-file-list":"",class:"self-stretch justify-start items-center gap-4 inline-flex"},{default:h(()=>[t(K,{therapist:e.value,size:"large"},null,8,["therapist"]),t(u,{preset:"primary",size:"small"},{default:h(()=>[A("Add image")]),_:1}),s.value?(y(),E(u,{key:0,preset:"primary",color:"danger",size:"small",icon:"delete",class:"z-10",onClick:a[0]||(a[0]=te(l=>s.value=void 0,["stop"]))})):Y("",!0)]),_:1},8,["modelValue"]),n("div",he,[n("div",be,[t(V,{modelValue:e.value.name,"onUpdate:modelValue":a[2]||(a[2]=l=>e.value.name=l),label:"名稱",class:"w-full sm:w-1/2",rules:[f(D).required],name:"name"},null,8,["modelValue","rules"]),t(V,{modelValue:e.value.number,"onUpdate:modelValue":a[3]||(a[3]=l=>e.value.number=l),label:"號碼",class:"w-full sm:w-1/2",rules:[f(D).required],name:"number",type:"number"},null,8,["modelValue","rules"])]),n("div",Ve,[t(V,{modelValue:e.value.height,"onUpdate:modelValue":a[4]||(a[4]=l=>e.value.height=l),label:"身高 (cm)",class:"w-full sm:w-1/2",name:"height",type:"number"},null,8,["modelValue"]),t(V,{modelValue:e.value.weight,"onUpdate:modelValue":a[5]||(a[5]=l=>e.value.weight=l),label:"體重 (kg)",class:"w-full sm:w-1/2",name:"weight",type:"number"},null,8,["modelValue"])]),n("div",we,[t(V,{modelValue:e.value.birthYear,"onUpdate:modelValue":a[6]||(a[6]=l=>e.value.birthYear=l),label:"出生年份",class:"w-full sm:w-1/2",name:"birthYear",type:"number"},null,8,["modelValue"]),t(V,{modelValue:e.value.technicalLevel,"onUpdate:modelValue":a[7]||(a[7]=l=>e.value.technicalLevel=l),label:"技術級別",class:"w-full sm:w-1/2",name:"technicalLevel"},null,8,["modelValue"])]),n("div",ye,[t(V,{modelValue:e.value.serviceMedal,"onUpdate:modelValue":a[8]||(a[8]=l=>e.value.serviceMedal=l),label:"服務獎章",class:"w-full sm:w-1/2",name:"serviceMedal"},null,8,["modelValue"]),t(V,{modelValue:e.value.recommendRank,"onUpdate:modelValue":a[9]||(a[9]=l=>e.value.recommendRank=l),label:"推薦指數",class:"w-full sm:w-1/2",name:"recommendRank"},null,8,["modelValue"])]),n("div",_e,[xe,t(R,{modelValue:c.value,"onUpdate:modelValue":a[10]||(a[10]=l=>c.value=l),type:"gallery","file-types":"image/*",class:"w-full","hide-file-list":""},{default:h(()=>[t(u,{preset:"primary",size:"small"},{default:h(()=>[A("上傳相片")]),_:1})]),_:1},8,["modelValue"]),((M=e.value.imageUrls)==null?void 0:M.length)>0||c.value.length>0?(y(),$("div",ke,[(y(!0),$(F,null,H(e.value.imageUrls,(l,k)=>(y(),$("div",{key:`existing-${k}`,class:"relative w-20 h-20 border border-gray-300 rounded overflow-hidden"},[n("img",{src:l,alt:`Existing Photo ${k+1}`,class:"w-full h-full object-cover"},null,8,Ue),t(u,{preset:"primary",color:"danger",size:"small",icon:"delete",class:"absolute top-1 right-1 w-6 h-6 min-w-0 p-0",onClick:j=>g(k)},null,8,["onClick"])]))),128)),(y(!0),$(F,null,H(c.value,(l,k)=>(y(),$("div",{key:`new-${k}`,class:"relative w-20 h-20 border border-gray-300 rounded overflow-hidden"},[n("img",{src:m(l),alt:`New Photo ${k+1}`,class:"w-full h-full object-cover"},null,8,$e),t(u,{preset:"primary",color:"danger",size:"small",icon:"delete",class:"absolute top-1 right-1 w-6 h-6 min-w-0 p-0",onClick:j=>c.value.splice(k,1)},null,8,["onClick"])]))),128))])):Y("",!0)]),n("div",Ce,[n("div",Te,[t(S,{modelValue:e.value.isActive,"onUpdate:modelValue":a[11]||(a[11]=l=>e.value.isActive=l),label:"Active",class:"w-full",name:"active"},null,8,["modelValue"])])]),t(O,{modelValue:e.value.description,"onUpdate:modelValue":a[12]||(a[12]=l=>e.value.description=l),label:"Description",class:"w-full",name:"description"},null,8,["modelValue"]),t(O,{modelValue:e.value.note,"onUpdate:modelValue":a[13]||(a[13]=l=>e.value.note=l),label:"Notes",class:"w-full",name:"note"},null,8,["modelValue"]),t(O,{modelValue:e.value.paymentNote,"onUpdate:modelValue":a[14]||(a[14]=l=>e.value.paymentNote=l),label:"Payment Note",class:"w-full",name:"paymentNote"},null,8,["modelValue"]),n("div",Ae,[t(V,{modelValue:e.value.sortOrder,"onUpdate:modelValue":a[15]||(a[15]=l=>e.value.sortOrder=l),label:"Sort Order",class:"w-full sm:w-1/2",rules:[f(D).required],name:"sortOrder",type:"number"},null,8,["modelValue","rules"]),t(V,{modelValue:e.value.removal,"onUpdate:modelValue":a[16]||(a[16]=l=>e.value.removal=l),label:"Removal Status",class:"w-full sm:w-1/2",name:"removal"},null,8,["modelValue"])]),n("div",Ne,[t(u,{preset:"secondary",color:"secondary",onClick:a[17]||(a[17]=l=>o.$emit("close"))},{default:h(()=>[A("Cancel")]),_:1}),t(u,{disabled:!L,onClick:I},{default:h(()=>[A(N(b.saveButtonLabel),1)]),_:2},1032,["disabled"])])])]}),_:1},512)}}}),Oe=n("h1",{class:"page-title"},"龍筋技師",-1),Be={class:"flex flex-col md:flex-row gap-2 mb-2 justify-between"},Re={class:"flex flex-col md:flex-row gap-2 justify-start"},Me={class:"va-h5"},Ye=P({__name:"TherapistsPage",setup(b){const p=_(!1),{therapists:x,isLoading:d,filters:i,sorting:r,pagination:e,...w}=Q(),s=_(null),c=a=>{s.value=a,p.value=!0},C=()=>{s.value=null,p.value=!0},{init:m}=oe(),g=async a=>{try{"id"in a?(await w.update(a),m({message:`${a.name} has been updated`,color:"success"})):(await w.add(a),m({message:`${a.name} has been created`,color:"success"}))}catch{m({message:"Operation failed. Please try again.",color:"danger"})}},U=async a=>{await w.remove(a),m({message:`${a.fullname} has been deleted`,color:"success"})},T=_(),{confirm:I}=G(),o=async a=>{T.value.isFormHasUnsavedChanges?await I({maxWidth:"380px",message:"Form has unsaved changes. Are you sure you want to close it?",size:"small"})&&a():a()};return(a,u)=>{const R=v("VaButtonToggle"),V=v("VaIcon"),S=v("VaInput"),O=v("VaButton"),z=v("VaCardContent"),L=v("VaCard"),M=v("VaModal");return y(),$(F,null,[Oe,t(L,null,{default:h(()=>[t(z,null,{default:h(()=>[n("div",Be,[n("div",Re,[t(R,{modelValue:f(i).isActive,"onUpdate:modelValue":u[0]||(u[0]=l=>f(i).isActive=l),color:"background-element","border-color":"background-element",options:[{label:"Active",value:!0},{label:"Inactive",value:!1}]},null,8,["modelValue"]),t(S,{modelValue:f(i).search,"onUpdate:modelValue":u[1]||(u[1]=l=>f(i).search=l),placeholder:"Search"},{prependInner:h(()=>[t(V,{name:"search",color:"secondary",size:"small"})]),_:1},8,["modelValue"])]),t(O,{onClick:C},{default:h(()=>[A("Add Therapist")]),_:1})]),t(ce,{"sort-by":f(r).sortBy,"onUpdate:sortBy":u[2]||(u[2]=l=>f(r).sortBy=l),"sorting-order":f(r).sortingOrder,"onUpdate:sortingOrder":u[3]||(u[3]=l=>f(r).sortingOrder=l),therapists:f(x),loading:f(d),pagination:f(e),onEditTherapist:c,onDeleteTherapist:U},null,8,["sort-by","sorting-order","therapists","loading","pagination"])]),_:1})]),_:1}),t(M,{modelValue:p.value,"onUpdate:modelValue":u[4]||(u[4]=l=>p.value=l),size:"small","mobile-fullscreen":"","close-button":"","hide-default-actions":"","before-cancel":o},{default:h(({cancel:l,ok:k})=>[n("h1",Me,N(s.value?"Edit therapist":"Add therapist"),1),t(Ie,{ref_key:"editFormRef",ref:T,therapist:s.value,"save-button-label":s.value?"Save":"Add",onClose:l,onSave:j=>{g(j),k()}},null,8,["therapist","save-button-label","onClose","onSave"])]),_:1},8,["modelValue"])],64)}}});export{Ye as default};
//# sourceMappingURL=TherapistsPage-bd26e22c.js.map
