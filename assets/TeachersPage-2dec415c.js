import{d as ee,w as ae}from"./index-12a73b2b.js";import{u as G}from"./useModal-f9d7addc.js";import{d as P,f,a as V,g as R,Z as te,e as J,c as U,h as t,w as b,b as u,t as A,i as I,u as h,$ as q,H as M,F as z,_ as le,r as _,C as Y,Y as B,R as oe,x as W}from"./index-c5c43275.js";import{u as H}from"./index-061b1ece.js";import{u as se}from"./useForm-fa0c5f1a.js";import{u as L}from"./useToast-f11ce6ac.js";import{v as Z}from"./utils-b2fc192b.js";const K=P({__name:"TeacherAvatar",props:{teacher:{type:Object,required:!0},size:{type:String,default:"medium"}},setup(y){const p=c=>{const d=["primary","#FFD43A","#ADFF00","#262824","danger"],r=c%d.length;return d[r]},x=c=>(console.log(c,"<= avatar"),c?c.startsWith("http")||c.startsWith("blob:"):!1);return(c,d)=>{const r=f("VaAvatar");return V(),R(r,{size:y.size,src:x(y.teacher.coverImageUrl)?y.teacher.coverImageUrl:"","fallback-text":y.teacher.number,color:p(y.teacher.number)},null,8,["size","src","fallback-text","color"])}}}),re={class:"font-semibold"},ne={class:"flex items-center gap-2 max-w-[230px] ellipsis"},ie={class:"text-center font-mono"},ue={class:"flex gap-2 justify-end"},ce={class:"flex flex-col-reverse md:flex-row gap-2 justify-between items-center py-2"},de={key:0,class:"flex"},me=P({__name:"TeachersTable",props:{teachers:{type:Array,required:!0},loading:{type:Boolean,default:!1},pagination:{type:Object,required:!0},sortBy:{type:String,required:!0},sortingOrder:{type:String,required:!0}},emits:["editTeacher","deleteTeacher","update:sortBy","update:sortingOrder"],setup(y,{emit:p}){const x=ee([{label:"ID",key:"id",sortable:!0},{label:"Number",key:"number",sortable:!0},{label:"Sort Order",key:"sortOrder",sortable:!0},{label:" ",key:"actions",align:"right"}]),c=y,d=p,r=te(c,"teachers"),e=H(c,"sortBy",d),w=H(c,"sortingOrder",d),l=J(()=>Math.ceil(c.pagination.total/c.pagination.perPage)),{confirm:o}=G(),$=async n=>{await o({title:"Delete teacher",message:`Are you sure you want to delete ${n.number}?`,okText:"Delete",cancelText:"Cancel",size:"small",maxWidth:"380px"})&&d("deleteTeacher",n)};return(n,v)=>{const k=f("VaButton"),C=f("VaDataTable"),O=f("VaSelect"),s=f("VaPagination");return V(),U(z,null,[t(C,{"sort-by":h(e),"onUpdate:sortBy":v[0]||(v[0]=a=>q(e)?e.value=a:null),"sorting-order":h(w),"onUpdate:sortingOrder":v[1]||(v[1]=a=>q(w)?w.value=a:null),columns:h(x),items:r.value,loading:n.$props.loading},{"cell(id)":b(({rowData:a})=>[u("div",re,A(a.id),1)]),"cell(number)":b(({rowData:a})=>[u("div",ne,[t(K,{teacher:a,size:"small"},null,8,["teacher"]),I(" "+A(a.number),1)])]),"cell(sortOrder)":b(({rowData:a})=>[u("div",ie,A(a.sortOrder),1)]),"cell(actions)":b(({rowData:a})=>[u("div",ue,[t(k,{preset:"primary",size:"small",icon:"mso-edit","aria-label":"Edit teacher",onClick:m=>n.$emit("editTeacher",a)},null,8,["onClick"]),t(k,{preset:"primary",size:"small",icon:"mso-delete",color:"danger","aria-label":"Delete teacher",onClick:m=>$(a)},null,8,["onClick"])])]),_:1},8,["sort-by","sorting-order","columns","items","loading"]),u("div",ce,[u("div",null,[u("b",null,A(n.$props.pagination.total)+" results.",1),I(" Results per page "),t(O,{modelValue:n.$props.pagination.perPage,"onUpdate:modelValue":v[2]||(v[2]=a=>n.$props.pagination.perPage=a),class:"!w-20",options:[10,50,100]},null,8,["modelValue"])]),l.value>1?(V(),U("div",de,[t(k,{preset:"secondary",icon:"va-arrow-left","aria-label":"Previous page",disabled:n.$props.pagination.page===1,onClick:v[3]||(v[3]=a=>n.$props.pagination.page--)},null,8,["disabled"]),t(k,{class:"mr-2",preset:"secondary",icon:"va-arrow-right","aria-label":"Next page",disabled:n.$props.pagination.page===l.value,onClick:v[4]||(v[4]=a=>n.$props.pagination.page++)},null,8,["disabled"]),t(s,{modelValue:n.$props.pagination.page,"onUpdate:modelValue":v[5]||(v[5]=a=>n.$props.pagination.page=a),"buttons-preset":"secondary",pages:l.value,"visible-pages":5,"boundary-links":!1,"direction-links":!1},null,8,["modelValue","pages"])])):M("",!0)])],64)}}});const pe=le(me,[["__scopeId","data-v-fa66d52a"]]),ge=()=>_({page:1,perPage:10,total:0}),ve=()=>_({sortBy:"name",sortingOrder:null}),fe=()=>_({isActive:!0,search:""}),Q=y=>{const p=_(!1),x=_([]),{filters:c=fe(),sorting:d=ve(),pagination:r=ge()}=y||{},e=async()=>{p.value=!0;const l={isActive:c.value.isActive,offset:r.value.page*r.value.perPage-r.value.perPage,limit:r.value.perPage},{data:o}=await B.axiosInstance.get("/plan/tutor/teacher",{params:l});x.value=o.data,console.log(o,"data"),w(()=>{r.value={page:r.value.page,perPage:r.value.perPage,total:o.total||o.data.length}}),p.value=!1},{ignoreUpdates:w}=ae([r,d],e,{deep:!0});return Y(c,()=>{r.value.page=1,e()},{deep:!0}),e(),{isLoading:p,filters:c,sorting:d,pagination:r,teachers:x,fetch:e,async add(l){p.value=!0;try{await B.axiosInstance.post("/plan/tutor/teacher",l),await e()}catch(o){throw console.error("Error adding teacher:",o),o}finally{p.value=!1}},async update(l){p.value=!0;const{id:o,...$}=l;await B.axiosInstance.patch(`/plan/tutor/teacher/${o}`,$),await e(),p.value=!1},async remove(l){p.value=!0,await B.axiosInstance.delete(`/plan/tutor/teacher/${l.id}`),await e(),p.value=!1},async uploadImages(l){try{const o=new FormData;return l.forEach(n=>{o.append("images",n)}),(await B.axiosInstance.post("/plan/tutor/teacher/images/upload",o,{headers:{"Content-Type":"multipart/form-data"}})).data.data.imageNames}catch(o){throw console.error("Error uploading images:",o),o}}}},he={class:"self-stretch flex-col justify-start items-start gap-4 flex"},be={class:"flex gap-4 flex-col sm:flex-row w-full"},ye={class:"flex gap-4 flex-col sm:flex-row w-full"},we={class:"flex gap-4 flex-col sm:flex-row w-full"},Ve={class:"w-full"},_e=u("label",{class:"va-input-label"},"相片集",-1),xe={key:0,class:"flex flex-wrap gap-2 mt-4"},$e=["src","alt"],ke=["src","alt"],Ue={class:"flex gap-4 w-full"},Ce={class:"flex items-center w-1/2 mt-4"},Te={class:"flex gap-4 flex-col sm:flex-row w-full"},Ie={class:"flex gap-2 flex-col-reverse items-stretch justify-end w-full sm:flex-row sm:items-center"},Ae=P({__name:"EditTeacherForm",props:{teacher:{type:Object,default:null},saveButtonLabel:{type:String,default:"Save"}},emits:["close","save"],setup(y,{expose:p,emit:x}){const{uploadImages:c}=Q(),d=y,r={id:-1,number:0,coverImage:"",images:[],height:0,weight:0,birthYear:0,sortOrder:0,isActive:!0,createdAt:"",updatedAt:"",deletedAt:null,coverImageUrl:"",imageUrls:[]},e=_({...r}),w=J(()=>Object.keys(e.value).some(s=>{var a;return s==="avatar"||s==="images"?!1:e.value[s]!==((a=d.teacher??r)==null?void 0:a[s])}));p({isFormHasUnsavedChanges:w}),Y(()=>d.teacher,()=>{d.teacher&&(e.value={...d.teacher})},{immediate:!0});const l=_(),o=_([]),$=s=>URL.createObjectURL(s),n=s=>URL.createObjectURL(s),v=s=>{e.value.imageUrls&&e.value.imageUrls.splice(s,1),e.value.images&&e.value.images.splice(s,1)};Y(l,s=>{e.value.coverImageUrl=s?$(s):""});const k=se("add-teacher-form"),C=x,O=async()=>{if(k.validate()){if(!l.value&&!e.value.coverImage){L().init({message:"請上傳大頭照",position:"top-right",color:"danger"});return}if(o.value.length===0&&e.value.images.length===0){L().init({message:"請至少上傳一張相片",position:"top-right",color:"danger"});return}if(l.value&&await c([l.value]).then(s=>{e.value.coverImage=s[0]}),o.value.length>0&&await c(o.value).then(s=>{e.value.images||(e.value.images=[]),e.value.images.push(...s)}),d.teacher){const s={id:d.teacher.id,number:e.value.number?Number(e.value.number):0,coverImage:e.value.coverImage,images:e.value.images,height:e.value.height?Number(e.value.height):0,weight:e.value.weight?Number(e.value.weight):0,birthYear:e.value.birthYear?Number(e.value.birthYear):0,sortOrder:Number(e.value.sortOrder)||0,isActive:e.value.isActive};C("save",s)}else{const s={number:e.value.number?Number(e.value.number):0,coverImage:e.value.coverImage,images:e.value.images,height:e.value.height?Number(e.value.height):0,weight:e.value.weight?Number(e.value.weight):0,birthYear:e.value.birthYear?Number(e.value.birthYear):0,sortOrder:Number(e.value.sortOrder)||0,isActive:e.value.isActive};C("save",s)}}};return(s,a)=>{const m=f("VaButton"),F=f("VaFileUpload"),T=f("VaInput"),S=f("VaCheckbox"),j=f("VaForm");return V(),R(j,{ref:"add-teacher-form",class:"flex-col justify-start items-start gap-4 inline-flex w-full"},{default:b(({isValid:D})=>{var N;return[t(F,{modelValue:l.value,"onUpdate:modelValue":a[1]||(a[1]=i=>l.value=i),type:"single","hide-file-list":"",class:"self-stretch justify-start items-center gap-4 inline-flex"},{default:b(()=>[t(K,{teacher:e.value,size:"large"},null,8,["teacher"]),t(m,{preset:"primary",size:"small"},{default:b(()=>[I("Add image")]),_:1}),l.value?(V(),R(m,{key:0,preset:"primary",color:"danger",size:"small",icon:"delete",class:"z-10",onClick:a[0]||(a[0]=oe(i=>l.value=void 0,["stop"]))})):M("",!0)]),_:1},8,["modelValue"]),u("div",he,[u("div",be,[t(T,{modelValue:e.value.number,"onUpdate:modelValue":a[2]||(a[2]=i=>e.value.number=i),label:"編號",class:"w-full sm:w-1/2",rules:[h(Z).required],name:"number",type:"number"},null,8,["modelValue","rules"])]),u("div",ye,[t(T,{modelValue:e.value.height,"onUpdate:modelValue":a[3]||(a[3]=i=>e.value.height=i),label:"身高 (cm)",placeholder:"身高",class:"w-full"},null,8,["modelValue"]),t(T,{modelValue:e.value.weight,"onUpdate:modelValue":a[4]||(a[4]=i=>e.value.weight=i),label:"體重 (kg)",placeholder:"體重",class:"w-full"},null,8,["modelValue"])]),u("div",we,[t(T,{modelValue:e.value.birthYear,"onUpdate:modelValue":a[5]||(a[5]=i=>e.value.birthYear=i),label:"出生年",placeholder:"出生年",class:"w-full"},null,8,["modelValue"])]),u("div",Ve,[_e,t(F,{modelValue:o.value,"onUpdate:modelValue":a[6]||(a[6]=i=>o.value=i),type:"gallery","file-types":"image/*",class:"w-full","hide-file-list":""},{default:b(()=>[t(m,{preset:"primary",size:"small"},{default:b(()=>[I("上傳相片")]),_:1})]),_:1},8,["modelValue"]),((N=e.value.imageUrls)==null?void 0:N.length)>0||o.value.length>0?(V(),U("div",xe,[(V(!0),U(z,null,W(e.value.imageUrls,(i,g)=>(V(),U("div",{key:`existing-${g}`,class:"relative w-20 h-20 border border-gray-300 rounded overflow-hidden"},[u("img",{src:i,alt:`Existing Photo ${g+1}`,class:"w-full h-full object-cover"},null,8,$e),t(m,{preset:"primary",color:"danger",size:"small",icon:"delete",class:"absolute top-1 right-1 w-6 h-6 min-w-0 p-0",onClick:E=>v(g)},null,8,["onClick"])]))),128)),(V(!0),U(z,null,W(o.value,(i,g)=>(V(),U("div",{key:`new-${g}`,class:"relative w-20 h-20 border border-gray-300 rounded overflow-hidden"},[u("img",{src:n(i),alt:`New Photo ${g+1}`,class:"w-full h-full object-cover"},null,8,ke),t(m,{preset:"primary",color:"danger",size:"small",icon:"delete",class:"absolute top-1 right-1 w-6 h-6 min-w-0 p-0",onClick:E=>o.value.splice(g,1)},null,8,["onClick"])]))),128))])):M("",!0)]),u("div",Ue,[u("div",Ce,[t(S,{modelValue:e.value.isActive,"onUpdate:modelValue":a[7]||(a[7]=i=>e.value.isActive=i),label:"Active",class:"w-full",name:"active"},null,8,["modelValue"])])]),u("div",Te,[t(T,{modelValue:e.value.sortOrder,"onUpdate:modelValue":a[8]||(a[8]=i=>e.value.sortOrder=i),label:"Sort Order",class:"w-full sm:w-1/2",rules:[h(Z).required],name:"sortOrder",type:"number"},null,8,["modelValue","rules"])]),u("div",Ie,[t(m,{preset:"secondary",color:"secondary",onClick:a[9]||(a[9]=i=>s.$emit("close"))},{default:b(()=>[I("Cancel")]),_:1}),t(m,{disabled:!D,onClick:O},{default:b(()=>[I(A(y.saveButtonLabel),1)]),_:2},1032,["disabled"])])])]}),_:1},512)}}}),Oe=u("h1",{class:"page-title"},"老師",-1),Be={class:"flex flex-col md:flex-row gap-2 mb-2 justify-between"},Fe={class:"flex flex-col md:flex-row gap-2 justify-start"},Ne={class:"va-h5"},Me=P({__name:"TeachersPage",setup(y){const p=_(!1),{teachers:x,isLoading:c,filters:d,sorting:r,pagination:e,...w}=Q(),l=_(null),o=a=>{l.value=a,p.value=!0},$=()=>{l.value=null,p.value=!0},{init:n}=L(),v=async a=>{try{"id"in a?(await w.update(a),n({message:`${a.number} has been updated`,color:"success"})):(await w.add(a),n({message:`${a.number} has been created`,color:"success"}))}catch{n({message:"Operation failed. Please try again.",color:"danger"})}},k=async a=>{await w.remove(a),n({message:`${a.number} has been deleted`,color:"success"})},C=_(),{confirm:O}=G(),s=async a=>{C.value.isFormHasUnsavedChanges?await O({maxWidth:"380px",message:"Form has unsaved changes. Are you sure you want to close it?",size:"small"})&&a():a()};return(a,m)=>{const F=f("VaButtonToggle"),T=f("VaIcon"),S=f("VaInput"),j=f("VaButton"),D=f("VaCardContent"),N=f("VaCard"),i=f("VaModal");return V(),U(z,null,[Oe,t(N,null,{default:b(()=>[t(D,null,{default:b(()=>[u("div",Be,[u("div",Fe,[t(F,{modelValue:h(d).isActive,"onUpdate:modelValue":m[0]||(m[0]=g=>h(d).isActive=g),color:"background-element","border-color":"background-element",options:[{label:"Active",value:!0},{label:"Inactive",value:!1}]},null,8,["modelValue"]),t(S,{modelValue:h(d).search,"onUpdate:modelValue":m[1]||(m[1]=g=>h(d).search=g),placeholder:"Search"},{prependInner:b(()=>[t(T,{name:"search",color:"secondary",size:"small"})]),_:1},8,["modelValue"])]),t(j,{onClick:$},{default:b(()=>[I("Add Teacher")]),_:1})]),t(pe,{"sort-by":h(r).sortBy,"onUpdate:sortBy":m[2]||(m[2]=g=>h(r).sortBy=g),"sorting-order":h(r).sortingOrder,"onUpdate:sortingOrder":m[3]||(m[3]=g=>h(r).sortingOrder=g),teachers:h(x),loading:h(c),pagination:h(e),onEditTeacher:o,onDeleteTeacher:k},null,8,["sort-by","sorting-order","teachers","loading","pagination"])]),_:1})]),_:1}),t(i,{modelValue:p.value,"onUpdate:modelValue":m[4]||(m[4]=g=>p.value=g),size:"small","mobile-fullscreen":"","close-button":"","hide-default-actions":"","before-cancel":s},{default:b(({cancel:g,ok:E})=>[u("h1",Ne,A(l.value?"Edit teacher":"Add teacher"),1),t(Ae,{ref_key:"editFormRef",ref:C,teacher:l.value,"save-button-label":l.value?"Save":"Add",onClose:g,onSave:X=>{v(X),E()}},null,8,["teacher","save-button-label","onClose","onSave"])]),_:1},8,["modelValue"])],64)}}});export{Me as default};
//# sourceMappingURL=TeachersPage-2dec415c.js.map
