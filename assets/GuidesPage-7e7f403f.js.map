{"version":3,"file":"GuidesPage-7e7f403f.js","sources":["../../src/pages/guides/widgets/GuideAvatar.vue","../../src/pages/guides/widgets/GuidesTable.vue","../../src/pages/guides/composables/useGuides.ts","../../src/pages/guides/widgets/EditGuideForm.vue","../../src/pages/guides/GuidesPage.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { PropType } from 'vue'\nimport { Guide } from '../types'\n\nconst avatarColor = (guideName: string) => {\n    const colors = ['primary', '#FFD43A', '#ADFF00', '#262824', 'danger']\n    const index = guideName.charCodeAt(0) % colors.length\n    return colors[index]\n}\n\ndefineProps({\n    guide: {\n        type: Object as PropType<Guide>,\n        required: true,\n    },\n    size: {\n        type: String,\n        default: 'medium',\n    },\n})\n\nconst isUrl = (avatar: string) => {\n    if (!avatar) return false\n    return avatar.startsWith('http') || avatar.startsWith('blob:')\n}\n</script>\n\n<template>\n    <VaAvatar\n        :size=\"size\"\n        :src=\"isUrl(guide.coverImageUrl) ? guide.coverImageUrl : ''\"\n        :fallback-text=\"guide.name[0]\"\n        :color=\"avatarColor(guide.name)\"\n    />\n</template>\n","<script setup lang=\"ts\">\nimport { defineVaDataTableColumns, useModal } from 'vuestic-ui'\nimport { Guide } from '../types'\nimport GuideAvatar from '../widgets/GuideAvatar.vue'\nimport { PropType, computed, toRef } from 'vue'\nimport { Pagination, Sorting } from '../composables/useGuides'\nimport { useVModel } from '@vueuse/core'\n\nconst columns = defineVaDataTableColumns([\n    { label: 'ID', key: 'id', sortable: true },\n    { label: 'Name', key: 'name', sortable: true },\n    { label: 'Sort Order', key: 'sortOrder', sortable: true },\n    { label: ' ', key: 'actions', align: 'right' },\n])\n\nconst props = defineProps({\n    guides: {\n        type: Array as PropType<Guide[]>,\n        required: true,\n    },\n    loading: { type: Boolean, default: false },\n    pagination: { type: Object as PropType<Pagination>, required: true },\n    sortBy: { type: String as PropType<Sorting['sortBy']>, required: true },\n    sortingOrder: { type: String as PropType<Sorting['sortingOrder']>, required: true },\n})\n\nconst emit = defineEmits<{\n    (event: 'editGuide', guide: Guide): void\n    (event: 'deleteGuide', guide: Guide): void\n    (event: 'update:sortBy', sortBy: Sorting['sortBy']): void\n    (event: 'update:sortingOrder', sortingOrder: Sorting['sortingOrder']): void\n}>()\n\nconst guides = toRef(props, 'guides')\nconst sortByVModel = useVModel(props, 'sortBy', emit)\nconst sortingOrderVModel = useVModel(props, 'sortingOrder', emit)\n\nconst totalPages = computed(() => Math.ceil(props.pagination.total / props.pagination.perPage))\n\nconst { confirm } = useModal()\n\nconst onGuideDelete = async (guide: Guide) => {\n    const agreed = await confirm({\n        title: 'Delete guide',\n        message: `Are you sure you want to delete ${guide.name}?`,\n        okText: 'Delete',\n        cancelText: 'Cancel',\n        size: 'small',\n        maxWidth: '380px',\n    })\n\n    if (agreed) {\n        emit('deleteGuide', guide)\n    }\n}\n</script>\n\n<template>\n    <VaDataTable\n        v-model:sort-by=\"sortByVModel\"\n        v-model:sorting-order=\"sortingOrderVModel\"\n        :columns=\"columns\"\n        :items=\"guides\"\n        :loading=\"$props.loading\"\n    >\n        <template #cell(number)=\"{ rowData }\">\n            <div class=\"font-semibold\">\n                {{ rowData.number }}\n            </div>\n        </template>\n\n        <template #cell(name)=\"{ rowData }\">\n            <div class=\"flex items-center gap-2 max-w-[230px] ellipsis\">\n                <GuideAvatar :guide=\"rowData as Guide\" size=\"small\" />\n                {{ rowData.name }}\n            </div>\n        </template>\n\n        <template #cell(sortOrder)=\"{ rowData }\">\n            <div class=\"text-center font-mono\">\n                {{ rowData.sortOrder }}\n            </div>\n        </template>\n\n        <template #cell(actions)=\"{ rowData }\">\n            <div class=\"flex gap-2 justify-end\">\n                <VaButton\n                    preset=\"primary\"\n                    size=\"small\"\n                    icon=\"mso-edit\"\n                    aria-label=\"Edit guide\"\n                    @click=\"$emit('editGuide', rowData as Guide)\"\n                />\n                <VaButton\n                    preset=\"primary\"\n                    size=\"small\"\n                    icon=\"mso-delete\"\n                    color=\"danger\"\n                    aria-label=\"Delete guide\"\n                    @click=\"onGuideDelete(rowData as Guide)\"\n                />\n            </div>\n        </template>\n    </VaDataTable>\n\n    <div class=\"flex flex-col-reverse md:flex-row gap-2 justify-between items-center py-2\">\n        <div>\n            <b>{{ $props.pagination.total }} results.</b>\n            Results per page\n            <VaSelect v-model=\"$props.pagination.perPage\" class=\"!w-20\" :options=\"[10, 50, 100]\" />\n        </div>\n\n        <div v-if=\"totalPages > 1\" class=\"flex\">\n            <VaButton\n                preset=\"secondary\"\n                icon=\"va-arrow-left\"\n                aria-label=\"Previous page\"\n                :disabled=\"$props.pagination.page === 1\"\n                @click=\"$props.pagination.page--\"\n            />\n            <VaButton\n                class=\"mr-2\"\n                preset=\"secondary\"\n                icon=\"va-arrow-right\"\n                aria-label=\"Next page\"\n                :disabled=\"$props.pagination.page === totalPages\"\n                @click=\"$props.pagination.page++\"\n            />\n            <VaPagination\n                v-model=\"$props.pagination.page\"\n                buttons-preset=\"secondary\"\n                :pages=\"totalPages\"\n                :visible-pages=\"5\"\n                :boundary-links=\"false\"\n                :direction-links=\"false\"\n            />\n        </div>\n    </div>\n</template>\n\n<style lang=\"scss\" scoped>\n.va-data-table {\n    ::v-deep(.va-data-table__table-tr) {\n        border-bottom: 1px solid var(--va-background-border);\n    }\n}\n</style>\n","import { Ref, ref, watch } from 'vue'\nimport { Guide, CreateGuideRequest, UpdateGuideRequest } from '../types'\nimport { watchIgnorable } from '@vueuse/core'\nimport api from '../../../services/api'\n\n// 類型定義移到這裡，不再依賴 data 層\nexport type Pagination = {\n    page: number\n    perPage: number\n    total: number\n}\n\nexport type Sorting = {\n    sortBy: keyof Guide | undefined\n    sortingOrder: 'asc' | 'desc' | null\n}\n\nexport type Filters = {\n    isActive: boolean\n    search: string\n}\n\nconst makePaginationRef = () => ref<Pagination>({ page: 1, perPage: 10, total: 0 })\nconst makeSortingRef = () => ref<Sorting>({ sortBy: 'name', sortingOrder: null })\nconst makeFiltersRef = () => ref<Partial<Filters>>({ isActive: true, search: '' })\n\nexport const useGuides = (options?: {\n    pagination?: Ref<Pagination>\n    sorting?: Ref<Sorting>\n    filters?: Ref<Partial<Filters>>\n}) => {\n    const isLoading = ref(false)\n    const guides = ref<Guide[]>([])\n\n    const { filters = makeFiltersRef(), sorting = makeSortingRef(), pagination = makePaginationRef() } = options || {}\n\n    const fetch = async () => {\n        isLoading.value = true\n        const params = {\n            isActive: filters.value.isActive,\n            offset: pagination.value.page * pagination.value.perPage - pagination.value.perPage,\n            limit: pagination.value.perPage,\n        }\n        const { data } = await api.axiosInstance.get('/plan/escort/guide', { params })\n        guides.value = data.data\n        console.log(data, 'data')\n        ignoreUpdates(() => {\n            pagination.value = {\n                page: pagination.value.page,\n                perPage: pagination.value.perPage,\n                total: data.total || data.data.length,\n            }\n        })\n\n        isLoading.value = false\n    }\n\n    const { ignoreUpdates } = watchIgnorable([pagination, sorting], fetch, { deep: true })\n\n    watch(\n        filters,\n        () => {\n            // Reset pagination to first page when filters changed\n            pagination.value.page = 1\n            fetch()\n        },\n        { deep: true },\n    )\n\n    fetch()\n\n    return {\n        isLoading,\n\n        filters,\n        sorting,\n        pagination,\n\n        guides,\n\n        fetch,\n\n        async add(guide: CreateGuideRequest) {\n            isLoading.value = true\n            try {\n                await api.axiosInstance.post('/plan/escort/guide', guide)\n                await fetch()\n            } catch (error) {\n                console.error('Error adding guide:', error)\n                throw error\n            } finally {\n                isLoading.value = false\n            }\n        },\n\n        async update(guide: UpdateGuideRequest) {\n            isLoading.value = true\n            const { id, ...guideData } = guide\n            await api.axiosInstance.put(`/plan/escort/guide/${id}`, guideData)\n            await fetch()\n            isLoading.value = false\n        },\n\n        async remove(guide: Guide) {\n            isLoading.value = true\n            await api.axiosInstance.delete(`/plan/escort/guide/${guide.id}`)\n            await fetch()\n            isLoading.value = false\n        },\n\n        async uploadImages(images: File[]): Promise<string[]> {\n            try {\n                const formData = new FormData()\n                images.forEach((image) => {\n                    formData.append('images', image)\n                })\n                const response = await api.axiosInstance.post('/plan/escort/guide/images/upload', formData, {\n                    headers: {\n                        'Content-Type': 'multipart/form-data',\n                    },\n                })\n                return response.data.data.imageNames\n            } catch (error) {\n                console.error('Error uploading images:', error)\n                throw error\n            }\n        },\n    }\n}\n","<script setup lang=\"ts\">\nimport { PropType, computed, ref, watch } from 'vue'\nimport { useForm, useToast } from 'vuestic-ui'\nimport { Guide, CreateGuideRequest, UpdateGuideRequest } from '../types'\nimport GuideAvatar from '../widgets/GuideAvatar.vue'\nimport { validators } from '../../../services/utils'\nimport { useGuides } from '../composables/useGuides'\nconst { uploadImages } = useGuides()\nconst props = defineProps({\n    guide: {\n        type: Object as PropType<Guide | null>,\n        default: null,\n    },\n    saveButtonLabel: {\n        type: String,\n        default: 'Save',\n    },\n})\n\nconst defaultNewGuide: Guide = {\n    id: -1,\n    name: '',\n    coverImage: '',\n    images: [],\n    height: 0,\n    weight: 0,\n    birthYear: 0,\n    language: [],\n    feature: [],\n    hobby: [],\n    sortOrder: 0,\n    isActive: true,\n    createdAt: '',\n    updatedAt: '',\n    deletedAt: null,\n    coverImageUrl: '',\n    imageUrls: [],\n}\n\nconst newGuide = ref<Guide>({ ...defaultNewGuide })\n\nconst isFormHasUnsavedChanges = computed(() => {\n    return Object.keys(newGuide.value).some((key) => {\n        if (key === 'avatar' || key === 'images') {\n            return false\n        }\n\n        return newGuide.value[key as keyof Guide] !== (props.guide ?? defaultNewGuide)?.[key as keyof Guide]\n    })\n})\n\ndefineExpose({\n    isFormHasUnsavedChanges,\n})\nconst languageOptions = ref<string[]>([])\nconst featureOptions = ref<string[]>([])\nconst hobbyOptions = ref<string[]>([])\nwatch(\n    () => props.guide,\n    () => {\n        if (!props.guide) {\n            return\n        }\n\n        newGuide.value = {\n            ...props.guide,\n        }\n        languageOptions.value = props.guide.language || []\n        featureOptions.value = props.guide.feature || []\n        hobbyOptions.value = props.guide.hobby || []\n    },\n    { immediate: true },\n)\nconst addLanguageOption = (newOption: string) => {\n    if (!languageOptions.value.includes(newOption)) {\n        languageOptions.value.push(newOption)\n    }\n}\nconst addFeatureOption = (newOption: string) => {\n    if (!featureOptions.value.includes(newOption)) {\n        featureOptions.value.push(newOption)\n    }\n}\nconst addHobbyOption = (newOption: string) => {\n    if (!hobbyOptions.value.includes(newOption)) {\n        hobbyOptions.value.push(newOption)\n    }\n}\nconst avatar = ref<File>()\nconst originalImages = ref<File[]>([])\n\nconst makeAvatarBlobUrl = (avatar: File) => {\n    return URL.createObjectURL(avatar)\n}\n\nconst makeImageBlobUrl = (image: File) => {\n    return URL.createObjectURL(image)\n}\n\nconst removeExistingImage = (index: number) => {\n    if (newGuide.value.imageUrls) {\n        newGuide.value.imageUrls.splice(index, 1)\n    }\n    if (newGuide.value.images) {\n        newGuide.value.images.splice(index, 1)\n    }\n}\n\nwatch(avatar, (newAvatar) => {\n    newGuide.value.coverImageUrl = newAvatar ? makeAvatarBlobUrl(newAvatar) : ''\n})\n\nconst form = useForm('add-guide-form')\n\nconst emit = defineEmits<{\n    close: []\n    save: [guide: CreateGuideRequest | UpdateGuideRequest]\n}>()\n\nconst onSave = async () => {\n    // 首先驗證表單，如果驗證失敗就直接返回\n    if (!form.validate()) {\n        return\n    }\n\n    if (!avatar.value && !newGuide.value.coverImage) {\n        // 如果沒有上傳封面圖片，且無現有封面圖片，則不可送出\n        useToast().init({ message: '請上傳大頭照', position: 'top-right', color: 'danger' })\n        return\n    }\n    if (originalImages.value.length === 0 && newGuide.value.images.length === 0) {\n        // 如果沒有上傳相片集，且無現有相片集，則不可送出\n        useToast().init({ message: '請至少上傳一張相片', position: 'top-right', color: 'danger' })\n        return\n    }\n\n    if (avatar.value) {\n        await uploadImages([avatar.value]).then((response: string[]) => {\n            newGuide.value.coverImage = response[0]\n        })\n    }\n    if (originalImages.value.length > 0) {\n        await uploadImages(originalImages.value).then((response: string[]) => {\n            // 增量式新增圖片，不覆蓋既有的圖片\n            if (!newGuide.value.images) {\n                newGuide.value.images = []\n            }\n            newGuide.value.images.push(...response)\n        })\n    }\n\n    // 判斷是新增還是編輯\n    if (props.guide) {\n        // 編輯模式 - 使用 UpdateGuideRequest\n        const guideData: UpdateGuideRequest = {\n            id: props.guide.id,\n            name: newGuide.value.name,\n            coverImage: newGuide.value.coverImage,\n            images: newGuide.value.images,\n            height: newGuide.value.height ? Number(newGuide.value.height) : 0,\n            weight: newGuide.value.weight ? Number(newGuide.value.weight) : 0,\n            birthYear: newGuide.value.birthYear ? Number(newGuide.value.birthYear) : 0,\n            language: newGuide.value.language,\n            feature: newGuide.value.feature,\n            hobby: newGuide.value.hobby,\n            sortOrder: Number(newGuide.value.sortOrder) || 0,\n            isActive: newGuide.value.isActive,\n        }\n\n        emit('save', guideData)\n    } else {\n        // 新增模式 - 使用 CreateGuideRequest\n        const guideData: CreateGuideRequest = {\n            name: newGuide.value.name,\n            coverImage: newGuide.value.coverImage,\n            images: newGuide.value.images,\n            height: newGuide.value.height ? Number(newGuide.value.height) : 0,\n            weight: newGuide.value.weight ? Number(newGuide.value.weight) : 0,\n            birthYear: newGuide.value.birthYear ? Number(newGuide.value.birthYear) : 0,\n            language: newGuide.value.language,\n            feature: newGuide.value.feature,\n            hobby: newGuide.value.hobby,\n            sortOrder: Number(newGuide.value.sortOrder) || 0,\n            isActive: newGuide.value.isActive,\n        }\n\n        emit('save', guideData)\n    }\n}\n</script>\n\n<template>\n    <VaForm\n        v-slot=\"{ isValid }\"\n        ref=\"add-guide-form\"\n        class=\"flex-col justify-start items-start gap-4 inline-flex w-full\"\n    >\n        <VaFileUpload\n            v-model=\"avatar\"\n            type=\"single\"\n            hide-file-list\n            class=\"self-stretch justify-start items-center gap-4 inline-flex\"\n        >\n            <GuideAvatar :guide=\"newGuide\" size=\"large\" />\n            <VaButton preset=\"primary\" size=\"small\">Add image</VaButton>\n            <VaButton\n                v-if=\"avatar\"\n                preset=\"primary\"\n                color=\"danger\"\n                size=\"small\"\n                icon=\"delete\"\n                class=\"z-10\"\n                @click.stop=\"avatar = undefined\"\n            />\n        </VaFileUpload>\n        <div class=\"self-stretch flex-col justify-start items-start gap-4 flex\">\n            <div class=\"flex gap-4 flex-col sm:flex-row w-full\">\n                <VaInput\n                    v-model=\"newGuide.name\"\n                    label=\"名稱\"\n                    class=\"w-full sm:w-1/2\"\n                    :rules=\"[validators.required]\"\n                    name=\"name\"\n                />\n            </div>\n            <div class=\"flex gap-4 flex-col sm:flex-row w-full\">\n                <VaInput\n                    v-model=\"newGuide.height\"\n                    label=\"身高 (cm)\"\n                    class=\"w-full sm:w-1/2\"\n                    name=\"height\"\n                    type=\"number\"\n                />\n                <VaInput\n                    v-model=\"newGuide.weight\"\n                    label=\"體重 (kg)\"\n                    class=\"w-full sm:w-1/2\"\n                    name=\"weight\"\n                    type=\"number\"\n                />\n            </div>\n            <div class=\"flex gap-4 flex-col sm:flex-row w-full\">\n                <VaInput\n                    v-model=\"newGuide.birthYear\"\n                    label=\"出生年份\"\n                    class=\"w-full sm:w-1/2\"\n                    name=\"birthYear\"\n                    type=\"number\"\n                />\n            </div>\n\n            <!-- Language 和 Feature 欄位 -->\n            <div class=\"flex gap-4 flex-col sm:flex-row w-full\">\n                <VaSelect\n                    v-model=\"newGuide.language\"\n                    label=\"語言能力\"\n                    class=\"w-full sm:w-1/2\"\n                    name=\"language\"\n                    multiple\n                    :options=\"languageOptions\"\n                    allow-create=\"unique\"\n                    @createNew=\"addLanguageOption\"\n                />\n                <VaSelect\n                    v-model=\"newGuide.feature\"\n                    label=\"服務特色\"\n                    class=\"w-full sm:w-1/2\"\n                    name=\"feature\"\n                    multiple\n                    :options=\"featureOptions\"\n                    allow-create=\"unique\"\n                    @createNew=\"addFeatureOption\"\n                />\n            </div>\n\n            <!-- Hobby 欄位 -->\n            <div class=\"flex gap-4 flex-col sm:flex-row w-full\">\n                <VaSelect\n                    v-model=\"newGuide.hobby\"\n                    label=\"興趣\"\n                    class=\"w-full sm:w-1/2\"\n                    name=\"hobby\"\n                    multiple\n                    :options=\"hobbyOptions\"\n                    allow-create=\"unique\"\n                    @createNew=\"addHobbyOption\"\n                />\n            </div>\n\n            <!-- 複數相片上傳 -->\n            <div class=\"w-full\">\n                <label class=\"va-input-label\">相片集</label>\n                <VaFileUpload\n                    v-model=\"originalImages\"\n                    type=\"gallery\"\n                    file-types=\"image/*\"\n                    class=\"w-full\"\n                    hide-file-list\n                >\n                    <VaButton preset=\"primary\" size=\"small\">上傳相片</VaButton>\n                </VaFileUpload>\n\n                <!-- 顯示縮圖 -->\n                <div\n                    v-if=\"newGuide.imageUrls?.length > 0 || originalImages.length > 0\"\n                    class=\"flex flex-wrap gap-2 mt-4\"\n                >\n                    <!-- 顯示舊有照片縮圖 -->\n                    <div\n                        v-for=\"(imageUrl, index) in newGuide.imageUrls\"\n                        :key=\"`existing-${index}`\"\n                        class=\"relative w-20 h-20 border border-gray-300 rounded overflow-hidden\"\n                    >\n                        <img :src=\"imageUrl\" :alt=\"`Existing Photo ${index + 1}`\" class=\"w-full h-full object-cover\" />\n                        <VaButton\n                            preset=\"primary\"\n                            color=\"danger\"\n                            size=\"small\"\n                            icon=\"delete\"\n                            class=\"absolute top-1 right-1 w-6 h-6 min-w-0 p-0\"\n                            @click=\"removeExistingImage(index)\"\n                        />\n                    </div>\n\n                    <!-- 顯示新上傳照片縮圖 -->\n                    <div\n                        v-for=\"(image, index) in originalImages\"\n                        :key=\"`new-${index}`\"\n                        class=\"relative w-20 h-20 border border-gray-300 rounded overflow-hidden\"\n                    >\n                        <img\n                            :src=\"makeImageBlobUrl(image)\"\n                            :alt=\"`New Photo ${index + 1}`\"\n                            class=\"w-full h-full object-cover\"\n                        />\n                        <VaButton\n                            preset=\"primary\"\n                            color=\"danger\"\n                            size=\"small\"\n                            icon=\"delete\"\n                            class=\"absolute top-1 right-1 w-6 h-6 min-w-0 p-0\"\n                            @click=\"originalImages.splice(index, 1)\"\n                        />\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"flex gap-4 w-full\">\n                <div class=\"flex items-center w-1/2 mt-4\">\n                    <VaCheckbox v-model=\"newGuide.isActive\" label=\"Active\" class=\"w-full\" name=\"active\" />\n                </div>\n            </div>\n\n            <div class=\"flex gap-4 flex-col sm:flex-row w-full\">\n                <VaInput\n                    v-model=\"newGuide.sortOrder\"\n                    label=\"Sort Order\"\n                    class=\"w-full sm:w-1/2\"\n                    :rules=\"[validators.required]\"\n                    name=\"sortOrder\"\n                    type=\"number\"\n                />\n            </div>\n            <div class=\"flex gap-2 flex-col-reverse items-stretch justify-end w-full sm:flex-row sm:items-center\">\n                <VaButton preset=\"secondary\" color=\"secondary\" @click=\"$emit('close')\">Cancel</VaButton>\n                <VaButton :disabled=\"!isValid\" @click=\"onSave\">{{ saveButtonLabel }}</VaButton>\n            </div>\n        </div>\n    </VaForm>\n</template>\n","<script setup lang=\"ts\">\nimport { ref } from 'vue'\nimport GuidesTable from '../guides/widgets/GuidesTable.vue'\nimport EditGuideForm from '../guides/widgets/EditGuideForm.vue'\nimport { Guide, CreateGuideRequest, UpdateGuideRequest } from '../guides/types'\nimport { useGuides } from '../guides/composables/useGuides'\nimport { useModal, useToast } from 'vuestic-ui'\n\nconst doShowEditGuideModal = ref(false)\n\nconst { guides, isLoading, filters, sorting, pagination, ...guidesApi } = useGuides()\n\nconst guideToEdit = ref<Guide | null>(null)\n\nconst showEditGuideModal = (guide: Guide) => {\n    guideToEdit.value = guide\n    doShowEditGuideModal.value = true\n}\n\nconst showAddGuideModal = () => {\n    guideToEdit.value = null\n    doShowEditGuideModal.value = true\n}\n\nconst { init: notify } = useToast()\n\nconst onGuideSaved = async (guide: CreateGuideRequest | UpdateGuideRequest) => {\n    try {\n        if ('id' in guide) {\n            // 編輯模式 - guide 包含 id 屬性\n            await guidesApi.update(guide as UpdateGuideRequest)\n            notify({\n                message: `${guide.name} has been updated`,\n                color: 'success',\n            })\n        } else {\n            // 新增模式 - guide 沒有 id 屬性\n            await guidesApi.add(guide as CreateGuideRequest)\n            notify({\n                message: `${guide.name} has been created`,\n                color: 'success',\n            })\n        }\n    } catch (error) {\n        notify({\n            message: 'Operation failed. Please try again.',\n            color: 'danger',\n        })\n    }\n}\n\nconst onGuideDelete = async (guide: Guide) => {\n    await guidesApi.remove(guide)\n    notify({\n        message: `${guide.name} has been deleted`,\n        color: 'success',\n    })\n}\n\nconst editFormRef = ref()\n\nconst { confirm } = useModal()\n\nconst beforeEditFormModalClose = async (hide: () => unknown) => {\n    if (editFormRef.value.isFormHasUnsavedChanges) {\n        const agreed = await confirm({\n            maxWidth: '380px',\n            message: 'Form has unsaved changes. Are you sure you want to close it?',\n            size: 'small',\n        })\n        if (agreed) {\n            hide()\n        }\n    } else {\n        hide()\n    }\n}\n</script>\n\n<template>\n    <h1 class=\"page-title\">奧黛導遊</h1>\n\n    <VaCard>\n        <VaCardContent>\n            <div class=\"flex flex-col md:flex-row gap-2 mb-2 justify-between\">\n                <div class=\"flex flex-col md:flex-row gap-2 justify-start\">\n                    <VaButtonToggle\n                        v-model=\"filters.isActive\"\n                        color=\"background-element\"\n                        border-color=\"background-element\"\n                        :options=\"[\n                            { label: 'Active', value: true },\n                            { label: 'Inactive', value: false },\n                        ]\"\n                    />\n                    <VaInput v-model=\"filters.search\" placeholder=\"Search\">\n                        <template #prependInner>\n                            <VaIcon name=\"search\" color=\"secondary\" size=\"small\" />\n                        </template>\n                    </VaInput>\n                </div>\n                <VaButton @click=\"showAddGuideModal\">Add Guide</VaButton>\n            </div>\n\n            <GuidesTable\n                v-model:sort-by=\"sorting.sortBy\"\n                v-model:sorting-order=\"sorting.sortingOrder\"\n                :guides=\"guides\"\n                :loading=\"isLoading\"\n                :pagination=\"pagination\"\n                @editGuide=\"showEditGuideModal\"\n                @deleteGuide=\"onGuideDelete\"\n            />\n        </VaCardContent>\n    </VaCard>\n\n    <VaModal\n        v-slot=\"{ cancel, ok }\"\n        v-model=\"doShowEditGuideModal\"\n        size=\"small\"\n        mobile-fullscreen\n        close-button\n        hide-default-actions\n        :before-cancel=\"beforeEditFormModalClose\"\n    >\n        <h1 class=\"va-h5\">{{ guideToEdit ? 'Edit guide' : 'Add guide' }}</h1>\n        <EditGuideForm\n            ref=\"editFormRef\"\n            :guide=\"guideToEdit\"\n            :save-button-label=\"guideToEdit ? 'Save' : 'Add'\"\n            @close=\"cancel\"\n            @save=\"\n                (guide: CreateGuideRequest | UpdateGuideRequest) => {\n                    onGuideSaved(guide)\n                    ok()\n                }\n            \"\n        />\n    </VaModal>\n</template>\n"],"names":["avatarColor","guideName","colors","index","isUrl","avatar","columns","defineVaDataTableColumns","props","__props","emit","__emit","guides","toRef","sortByVModel","useVModel","sortingOrderVModel","totalPages","computed","confirm","useModal","onGuideDelete","guide","makePaginationRef","ref","makeSortingRef","makeFiltersRef","useGuides","options","isLoading","filters","sorting","pagination","fetch","params","data","api","ignoreUpdates","watchIgnorable","watch","error","id","guideData","images","formData","image","uploadImages","defaultNewGuide","newGuide","isFormHasUnsavedChanges","key","_a","__expose","languageOptions","featureOptions","hobbyOptions","addLanguageOption","newOption","addFeatureOption","addHobbyOption","originalImages","makeAvatarBlobUrl","makeImageBlobUrl","removeExistingImage","newAvatar","form","useForm","onSave","useToast","response","doShowEditGuideModal","guidesApi","guideToEdit","showEditGuideModal","showAddGuideModal","notify","onGuideSaved","editFormRef","beforeEditFormModalClose","hide"],"mappings":"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"}