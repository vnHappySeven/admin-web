import{d as Z,w as ee}from"./index-f8a656f3.js";import{u as W}from"./useModal-042c6eaa.js";import{d as O,f as m,a as S,g as I,X as ae,e as H,c as M,h as t,w as y,b as g,i as B,t as $,u as d,Y as q,H as K,F as X,_ as te,r as T,C as D,R as se}from"./index-b40e6635.js";import{u as N}from"./index-f1ad94a1.js";import{u as le}from"./useForm-65e172db.js";import{u as oe}from"./useProjects-3fc40a5b.js";import{v as U,s as P}from"./utils-b2fc192b.js";import{u as ne}from"./useToast-fa01842c.js";const Y=O({__name:"TherapistAvatar",props:{therapist:{type:Object,required:!0},size:{type:String,default:"medium"}},setup(o){const s=n=>{const p=["primary","#FFD43A","#ADFF00","#262824","danger"],e=n.charCodeAt(0)%p.length;return p[e]},h=n=>n.startsWith("http")||n.startsWith("blob:");return(n,p)=>{const e=m("VaAvatar");return S(),I(e,{size:o.size,src:h(o.therapist.avatar)?o.therapist.avatar:"","fallback-text":o.therapist.avatar||o.therapist.fullname[0],color:s(o.therapist.fullname)},null,8,["size","src","fallback-text","color"])}}}),re={class:"flex items-center gap-2 max-w-[230px] ellipsis"},ie={class:"max-w-[120px] ellipsis"},ue={class:"ellipsis max-w-[230px]"},de={class:"ellipsis max-w-[300px] lg:max-w-[450px]"},pe={class:"flex gap-2 justify-end"},me={class:"flex flex-col-reverse md:flex-row gap-2 justify-between items-center py-2"},ce={key:0,class:"flex"},fe=O({__name:"TherapistsTable",props:{therapists:{type:Array,required:!0},loading:{type:Boolean,default:!1},pagination:{type:Object,required:!0},sortBy:{type:String,required:!0},sortingOrder:{type:String,required:!0}},emits:["edit-therapist","delete-therapist","update:sortBy","update:sortingOrder"],setup(o,{emit:s}){const h=Z([{label:"Full Name",key:"fullname",sortable:!0},{label:"Email",key:"email",sortable:!0},{label:"Username",key:"username",sortable:!0},{label:"Role",key:"role",sortable:!0},{label:"Projects",key:"projects",sortable:!0},{label:" ",key:"actions",align:"right"}]),n=o,p=s,e=ae(n,"therapists"),c=N(n,"sortBy",p),f=N(n,"sortingOrder",p),i={admin:"danger",therapist:"background-element",owner:"warning"},w=H(()=>Math.ceil(n.pagination.total/n.pagination.perPage)),{confirm:C}=W(),k=async u=>{await C({title:"Delete therapist",message:`Are you sure you want to delete ${u.fullname}?`,okText:"Delete",cancelText:"Cancel",size:"small",maxWidth:"380px"})&&p("delete-therapist",u)},F=u=>u.length===0?"No projects":u.length<=2?u.map(a=>a.project_name).join(", "):u.slice(0,2).map(a=>a.project_name).join(", ")+" + "+(u.length-2)+" more";return(u,a)=>{const r=m("VaBadge"),_=m("VaButton"),V=m("VaDataTable"),b=m("VaSelect"),j=m("VaPagination");return S(),M(X,null,[t(V,{"sort-by":d(c),"onUpdate:sortBy":a[0]||(a[0]=l=>q(c)?c.value=l:null),"sorting-order":d(f),"onUpdate:sortingOrder":a[1]||(a[1]=l=>q(f)?f.value=l:null),columns:d(h),items:e.value,loading:u.$props.loading},{"cell(fullname)":y(({rowData:l})=>[g("div",re,[t(Y,{therapist:l,size:"small"},null,8,["therapist"]),B(" "+$(l.fullname),1)])]),"cell(username)":y(({rowData:l})=>[g("div",ie,$(l.username),1)]),"cell(email)":y(({rowData:l})=>[g("div",ue,$(l.email),1)]),"cell(role)":y(({rowData:l})=>[t(r,{text:l.role,color:i[l.role]},null,8,["text","color"])]),"cell(projects)":y(({rowData:l})=>[g("div",de,$(F(l.projects)),1)]),"cell(actions)":y(({rowData:l})=>[g("div",pe,[t(_,{preset:"primary",size:"small",icon:"mso-edit","aria-label":"Edit therapist",onClick:z=>u.$emit("edit-therapist",l)},null,8,["onClick"]),t(_,{preset:"primary",size:"small",icon:"mso-delete",color:"danger","aria-label":"Delete therapist",onClick:z=>k(l)},null,8,["onClick"])])]),_:1},8,["sort-by","sorting-order","columns","items","loading"]),g("div",me,[g("div",null,[g("b",null,$(u.$props.pagination.total)+" results.",1),B(" Results per page "),t(b,{modelValue:u.$props.pagination.perPage,"onUpdate:modelValue":a[2]||(a[2]=l=>u.$props.pagination.perPage=l),class:"!w-20",options:[10,50,100]},null,8,["modelValue"])]),w.value>1?(S(),M("div",ce,[t(_,{preset:"secondary",icon:"va-arrow-left","aria-label":"Previous page",disabled:u.$props.pagination.page===1,onClick:a[3]||(a[3]=l=>u.$props.pagination.page--)},null,8,["disabled"]),t(_,{class:"mr-2",preset:"secondary",icon:"va-arrow-right","aria-label":"Next page",disabled:u.$props.pagination.page===w.value,onClick:a[4]||(a[4]=l=>u.$props.pagination.page++)},null,8,["disabled"]),t(j,{modelValue:u.$props.pagination.page,"onUpdate:modelValue":a[5]||(a[5]=l=>u.$props.pagination.page=l),"buttons-preset":"secondary",pages:w.value,"visible-pages":5,"boundary-links":!1,"direction-links":!1},null,8,["modelValue","pages"])])):K("",!0)])],64)}}});const ve=te(fe,[["__scopeId","data-v-2d23b013"]]),ge={class:"self-stretch flex-col justify-start items-start gap-4 flex"},he={class:"flex gap-4 flex-col sm:flex-row w-full"},Ve={class:"flex gap-4 flex-col sm:flex-row w-full"},be={class:"flex gap-4 w-full"},ye={class:"w-1/2"},we={class:"flex items-center w-1/2 mt-4"},_e={class:"flex gap-2 flex-col-reverse items-stretch justify-end w-full sm:flex-row sm:items-center"},xe=O({__name:"EditTherapistForm",props:{therapist:{type:Object,default:null},saveButtonLabel:{type:String,default:"Save"}},emits:["close","save"],setup(o,{expose:s,emit:h}){const n=o,p={id:-1,avatar:"",fullname:"",role:"therapist",username:"",notes:"",email:"",active:!0,projects:[]},e=T({...p}),c=H(()=>Object.keys(e.value).some(a=>{var r;return a==="avatar"||a==="projects"?!1:e.value[a]!==((r=n.therapist??p)==null?void 0:r[a])}));s({isFormHasUnsavedChanges:c}),D(()=>n.therapist,()=>{n.therapist&&(e.value={...n.therapist,avatar:n.therapist.avatar||""})},{immediate:!0});const f=T(),i=a=>URL.createObjectURL(a);D(f,a=>{e.value.avatar=a?i(a):""});const w=le("add-therapist-form"),C=h,k=()=>{w.validate()&&C("save",e.value)},F=[{text:"Admin",value:"admin"},{text:"Therapist",value:"therapist"},{text:"Owner",value:"owner"}],{projects:u}=oe({pagination:T({page:1,perPage:9999,total:10})});return(a,r)=>{const _=m("VaButton"),V=m("VaFileUpload"),b=m("VaInput"),j=m("VaSelect"),l=m("VaCheckbox"),z=m("VaTextarea"),R=m("VaForm");return S(),I(R,{ref:"add-therapist-form",class:"flex-col justify-start items-start gap-4 inline-flex w-full"},{default:y(({isValid:E})=>[t(V,{modelValue:f.value,"onUpdate:modelValue":r[1]||(r[1]=v=>f.value=v),type:"single","hide-file-list":"",class:"self-stretch justify-start items-center gap-4 inline-flex"},{default:y(()=>[t(Y,{therapist:e.value,size:"large"},null,8,["therapist"]),t(_,{preset:"primary",size:"small"},{default:y(()=>[B("Add image")]),_:1}),f.value?(S(),I(_,{key:0,preset:"primary",color:"danger",size:"small",icon:"delete",class:"z-10",onClick:r[0]||(r[0]=se(v=>f.value=void 0,["stop"]))})):K("",!0)]),_:1},8,["modelValue"]),g("div",ge,[g("div",he,[t(b,{modelValue:e.value.fullname,"onUpdate:modelValue":r[2]||(r[2]=v=>e.value.fullname=v),label:"Full name",class:"w-full sm:w-1/2",rules:[d(U).required],name:"fullname"},null,8,["modelValue","rules"]),t(b,{modelValue:e.value.username,"onUpdate:modelValue":r[3]||(r[3]=v=>e.value.username=v),label:"Username",class:"w-full sm:w-1/2",rules:[d(U).required],name:"username"},null,8,["modelValue","rules"])]),g("div",Ve,[t(b,{modelValue:e.value.email,"onUpdate:modelValue":r[4]||(r[4]=v=>e.value.email=v),label:"Email",class:"w-full sm:w-1/2",rules:[d(U).required,d(U).email],name:"email"},null,8,["modelValue","rules"]),t(j,{modelValue:e.value.projects,"onUpdate:modelValue":r[5]||(r[5]=v=>e.value.projects=v),label:"Projects",class:"w-full sm:w-1/2",options:d(u),rules:[d(U).required],name:"projects","text-by":"project_name","track-by":"id",multiple:"","max-visible-options":2},null,8,["modelValue","options","rules"])]),g("div",be,[g("div",ye,[t(j,{modelValue:e.value.role,"onUpdate:modelValue":r[6]||(r[6]=v=>e.value.role=v),label:"Role",class:"w-full",options:F,rules:[d(U).required],name:"role","value-by":"value"},null,8,["modelValue","rules"])]),g("div",we,[t(l,{modelValue:e.value.active,"onUpdate:modelValue":r[7]||(r[7]=v=>e.value.active=v),label:"Active",class:"w-full",name:"active"},null,8,["modelValue"])])]),t(z,{modelValue:e.value.notes,"onUpdate:modelValue":r[8]||(r[8]=v=>e.value.notes=v),label:"Notes",class:"w-full",name:"notes"},null,8,["modelValue"]),g("div",_e,[t(_,{preset:"secondary",color:"secondary",onClick:r[9]||(r[9]=v=>a.$emit("close"))},{default:y(()=>[B("Cancel")]),_:1}),t(_,{disabled:!E,onClick:k},{default:y(()=>[B($(o.saveButtonLabel),1)]),_:2},1032,["disabled"])])])]),_:1},512)}}}),Te=[{id:1,fullname:"Dr. Sarah Chen",email:"sarah.chen@example.com",username:"drchen",role:"therapist",avatar:"",active:!0,notes:"Specialized in deep tissue massage and sports therapy."},{id:2,fullname:"Michael Thompson",email:"mike.therapist@mail.com",username:"miketherapist",role:"admin",avatar:"🙌",active:!0,notes:"Senior therapist with 15+ years experience."},{id:3,fullname:"Lisa Rodriguez",email:"lisa.rodriguez@gmail.com",username:"lisarodriguez",role:"therapist",avatar:"https://randomuser.me/api/portraits/women/1.jpg",active:!0,notes:"Expert in relaxation and Swedish massage techniques."},{id:4,fullname:"David Kim",email:"david.kim@gmail.com",username:"davidkim",role:"owner",avatar:"",active:!0,notes:"Clinic owner and licensed massage therapist."},{id:5,fullname:"Emma Wilson",email:"emma.wilson@gmail.com",username:"emmawilson",role:"therapist",avatar:"https://randomuser.me/api/portraits/women/2.jpg",active:!0,notes:"Specializes in prenatal and therapeutic massage."}],A=Te,L=(o,s)=>s==="projects"?o.projects.map(h=>h.project_name).join(", "):o[s],ke=async o=>{await P(1e3);const{isActive:s,search:h,sortBy:n,sortingOrder:p}=o;let e=[...A];e=e.filter(i=>i.active===s),h&&(e=e.filter(i=>i.fullname.toLowerCase().includes(h.toLowerCase()))),e=e.map(i=>({...i,projects:[]})),n&&p&&(e=e.sort((i,w)=>{const C=L(i,n),k=L(w,n);return C>k?p==="asc"?1:-1:C<k?p==="asc"?-1:1:0}));const{page:c=1,perPage:f=10}=o||{};return{data:e.slice((c-1)*f,c*f),pagination:{page:c,perPage:f,total:e.length}}},Ce=async o=>{await P(1e3),A.unshift(o)},$e=async o=>{await P(1e3);const s=A.findIndex(h=>h.id===o.id);A[s]=o},je=async o=>{await P(1e3),A.splice(A.findIndex(s=>s.id===o.id),1)},Ue=()=>T({page:1,perPage:10,total:0}),Be=()=>T({sortBy:"fullname",sortingOrder:null}),Se=()=>T({isActive:!0,search:""}),Ae=o=>{const s=T(!1),h=T([]),{filters:n=Se(),sorting:p=Be(),pagination:e=Ue()}=o||{},c=async()=>{s.value=!0;const{data:i,pagination:w}=await ke({...d(n),...d(p),...d(e)});h.value=i,f(()=>{e.value=w}),s.value=!1},{ignoreUpdates:f}=ee([e,p],c,{deep:!0});return D(n,()=>{e.value.page=1,c()},{deep:!0}),c(),{isLoading:s,filters:n,sorting:p,pagination:e,therapists:h,fetch:c,async add(i){s.value=!0,await Ce(i),await c(),s.value=!1},async update(i){s.value=!0,await $e(i),await c(),s.value=!1},async remove(i){s.value=!0,await je(i),await c(),s.value=!1}}},Fe=g("h1",{class:"page-title"},"龍筋技師",-1),ze={class:"flex flex-col md:flex-row gap-2 mb-2 justify-between"},Oe={class:"flex flex-col md:flex-row gap-2 justify-start"},Pe={class:"va-h5"},We=O({__name:"TherapistsPage",setup(o){const s=T(!1),{therapists:h,isLoading:n,filters:p,sorting:e,pagination:c,...f}=Ae(),i=T(null),w=V=>{i.value=V,s.value=!0},C=()=>{i.value=null,s.value=!0},{init:k}=ne(),F=async V=>{i.value?(await f.update(V),k({message:`${V.fullname} has been updated`,color:"success"})):(f.add(V),k({message:`${V.fullname} has been created`,color:"success"}))},u=async V=>{await f.remove(V),k({message:`${V.fullname} has been deleted`,color:"success"})},a=T(),{confirm:r}=W(),_=async V=>{a.value.isFormHasUnsavedChanges?await r({maxWidth:"380px",message:"Form has unsaved changes. Are you sure you want to close it?",size:"small"})&&V():V()};return(V,b)=>{const j=m("VaButtonToggle"),l=m("VaIcon"),z=m("VaInput"),R=m("VaButton"),E=m("VaCardContent"),v=m("VaCard"),G=m("VaModal");return S(),M(X,null,[Fe,t(v,null,{default:y(()=>[t(E,null,{default:y(()=>[g("div",ze,[g("div",Oe,[t(j,{modelValue:d(p).isActive,"onUpdate:modelValue":b[0]||(b[0]=x=>d(p).isActive=x),color:"background-element","border-color":"background-element",options:[{label:"Active",value:!0},{label:"Inactive",value:!1}]},null,8,["modelValue"]),t(z,{modelValue:d(p).search,"onUpdate:modelValue":b[1]||(b[1]=x=>d(p).search=x),placeholder:"Search"},{prependInner:y(()=>[t(l,{name:"search",color:"secondary",size:"small"})]),_:1},8,["modelValue"])]),t(R,{onClick:C},{default:y(()=>[B("Add Therapist")]),_:1})]),t(ve,{"sort-by":d(e).sortBy,"onUpdate:sortBy":b[2]||(b[2]=x=>d(e).sortBy=x),"sorting-order":d(e).sortingOrder,"onUpdate:sortingOrder":b[3]||(b[3]=x=>d(e).sortingOrder=x),therapists:d(h),loading:d(n),pagination:d(c),onEditTherapist:w,onDeleteTherapist:u},null,8,["sort-by","sorting-order","therapists","loading","pagination"])]),_:1})]),_:1}),t(G,{modelValue:s.value,"onUpdate:modelValue":b[4]||(b[4]=x=>s.value=x),size:"small","mobile-fullscreen":"","close-button":"","hide-default-actions":"","before-cancel":_},{default:y(({cancel:x,ok:J})=>[g("h1",Pe,$(i.value?"Edit therapist":"Add therapist"),1),t(xe,{ref_key:"editFormRef",ref:a,therapist:i.value,"save-button-label":i.value?"Save":"Add",onClose:x,onSave:Q=>{F(Q),J()}},null,8,["therapist","save-button-label","onClose","onSave"])]),_:1},8,["modelValue"])],64)}}});export{We as default};
//# sourceMappingURL=TherapistsPage-57d45d22.js.map
