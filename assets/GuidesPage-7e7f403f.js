import{d as ne,w as re}from"./index-4d3fe16d.js";import{u as X}from"./useModal-26aaab1f.js";import{d as E,f as p,a as U,g as Y,Z as ie,e as ee,c as O,h as t,w as y,b as r,t as F,i as G,u as h,$ as Z,H as q,F as D,_ as ue,r as w,C as L,Y as z,R as de,x as J}from"./index-9c786ac1.js";import{u as K}from"./index-d6f75a84.js";import{u as me}from"./useForm-a4aa60d7.js";import{u as H}from"./useToast-23fe4bf7.js";import{v as Q}from"./utils-b2fc192b.js";const ae=E({__name:"GuideAvatar",props:{guide:{type:Object,required:!0},size:{type:String,default:"medium"}},setup(V){const g=c=>{const n=["primary","#FFD43A","#ADFF00","#262824","danger"],i=c.charCodeAt(0)%n.length;return n[i]},k=c=>c?c.startsWith("http")||c.startsWith("blob:"):!1;return(c,n)=>{const i=p("VaAvatar");return U(),Y(i,{size:V.size,src:k(V.guide.coverImageUrl)?V.guide.coverImageUrl:"","fallback-text":V.guide.name[0],color:g(V.guide.name)},null,8,["size","src","fallback-text","color"])}}}),ce={class:"font-semibold"},ge={class:"flex items-center gap-2 max-w-[230px] ellipsis"},pe={class:"text-center font-mono"},ve={class:"flex gap-2 justify-end"},fe={class:"flex flex-col-reverse md:flex-row gap-2 justify-between items-center py-2"},be={key:0,class:"flex"},he=E({__name:"GuidesTable",props:{guides:{type:Array,required:!0},loading:{type:Boolean,default:!1},pagination:{type:Object,required:!0},sortBy:{type:String,required:!0},sortingOrder:{type:String,required:!0}},emits:["editGuide","deleteGuide","update:sortBy","update:sortingOrder"],setup(V,{emit:g}){const k=ne([{label:"ID",key:"id",sortable:!0},{label:"Name",key:"name",sortable:!0},{label:"Sort Order",key:"sortOrder",sortable:!0},{label:" ",key:"actions",align:"right"}]),c=V,n=g,i=ie(c,"guides"),e=K(c,"sortBy",n),$=K(c,"sortingOrder",n),u=ee(()=>Math.ceil(c.pagination.total/c.pagination.perPage)),{confirm:d}=X(),C=async m=>{await d({title:"Delete guide",message:`Are you sure you want to delete ${m.name}?`,okText:"Delete",cancelText:"Cancel",size:"small",maxWidth:"380px"})&&n("deleteGuide",m)};return(m,v)=>{const I=p("VaButton"),_=p("VaDataTable"),x=p("VaSelect"),N=p("VaPagination");return U(),O(D,null,[t(_,{"sort-by":h(e),"onUpdate:sortBy":v[0]||(v[0]=a=>Z(e)?e.value=a:null),"sorting-order":h($),"onUpdate:sortingOrder":v[1]||(v[1]=a=>Z($)?$.value=a:null),columns:h(k),items:i.value,loading:m.$props.loading},{"cell(number)":y(({rowData:a})=>[r("div",ce,F(a.number),1)]),"cell(name)":y(({rowData:a})=>[r("div",ge,[t(ae,{guide:a,size:"small"},null,8,["guide"]),G(" "+F(a.name),1)])]),"cell(sortOrder)":y(({rowData:a})=>[r("div",pe,F(a.sortOrder),1)]),"cell(actions)":y(({rowData:a})=>[r("div",ve,[t(I,{preset:"primary",size:"small",icon:"mso-edit","aria-label":"Edit guide",onClick:b=>m.$emit("editGuide",a)},null,8,["onClick"]),t(I,{preset:"primary",size:"small",icon:"mso-delete",color:"danger","aria-label":"Delete guide",onClick:b=>C(a)},null,8,["onClick"])])]),_:1},8,["sort-by","sorting-order","columns","items","loading"]),r("div",fe,[r("div",null,[r("b",null,F(m.$props.pagination.total)+" results.",1),G(" Results per page "),t(x,{modelValue:m.$props.pagination.perPage,"onUpdate:modelValue":v[2]||(v[2]=a=>m.$props.pagination.perPage=a),class:"!w-20",options:[10,50,100]},null,8,["modelValue"])]),u.value>1?(U(),O("div",be,[t(I,{preset:"secondary",icon:"va-arrow-left","aria-label":"Previous page",disabled:m.$props.pagination.page===1,onClick:v[3]||(v[3]=a=>m.$props.pagination.page--)},null,8,["disabled"]),t(I,{class:"mr-2",preset:"secondary",icon:"va-arrow-right","aria-label":"Next page",disabled:m.$props.pagination.page===u.value,onClick:v[4]||(v[4]=a=>m.$props.pagination.page++)},null,8,["disabled"]),t(N,{modelValue:m.$props.pagination.page,"onUpdate:modelValue":v[5]||(v[5]=a=>m.$props.pagination.page=a),"buttons-preset":"secondary",pages:u.value,"visible-pages":5,"boundary-links":!1,"direction-links":!1},null,8,["modelValue","pages"])])):q("",!0)])],64)}}});const ye=ue(he,[["__scopeId","data-v-7787f899"]]),we=()=>w({page:1,perPage:10,total:0}),Ve=()=>w({sortBy:"name",sortingOrder:null}),_e=()=>w({isActive:!0,search:""}),le=V=>{const g=w(!1),k=w([]),{filters:c=_e(),sorting:n=Ve(),pagination:i=we()}=V||{},e=async()=>{g.value=!0;const u={isActive:c.value.isActive,offset:i.value.page*i.value.perPage-i.value.perPage,limit:i.value.perPage},{data:d}=await z.axiosInstance.get("/plan/escort/guide",{params:u});k.value=d.data,console.log(d,"data"),$(()=>{i.value={page:i.value.page,perPage:i.value.perPage,total:d.total||d.data.length}}),g.value=!1},{ignoreUpdates:$}=re([i,n],e,{deep:!0});return L(c,()=>{i.value.page=1,e()},{deep:!0}),e(),{isLoading:g,filters:c,sorting:n,pagination:i,guides:k,fetch:e,async add(u){g.value=!0;try{await z.axiosInstance.post("/plan/escort/guide",u),await e()}catch(d){throw console.error("Error adding guide:",d),d}finally{g.value=!1}},async update(u){g.value=!0;const{id:d,...C}=u;await z.axiosInstance.put(`/plan/escort/guide/${d}`,C),await e(),g.value=!1},async remove(u){g.value=!0,await z.axiosInstance.delete(`/plan/escort/guide/${u.id}`),await e(),g.value=!1},async uploadImages(u){try{const d=new FormData;return u.forEach(m=>{d.append("images",m)}),(await z.axiosInstance.post("/plan/escort/guide/images/upload",d,{headers:{"Content-Type":"multipart/form-data"}})).data.data.imageNames}catch(d){throw console.error("Error uploading images:",d),d}}}},xe={class:"self-stretch flex-col justify-start items-start gap-4 flex"},$e={class:"flex gap-4 flex-col sm:flex-row w-full"},Ce={class:"flex gap-4 flex-col sm:flex-row w-full"},Ue={class:"flex gap-4 flex-col sm:flex-row w-full"},ke={class:"flex gap-4 flex-col sm:flex-row w-full"},Ae={class:"flex gap-4 flex-col sm:flex-row w-full"},Ie={class:"w-full"},Oe=r("label",{class:"va-input-label"},"相片集",-1),Be={key:0,class:"flex flex-wrap gap-2 mt-4"},Ge=["src","alt"],Fe=["src","alt"],Ne={class:"flex gap-4 w-full"},Se={class:"flex items-center w-1/2 mt-4"},ze={class:"flex gap-4 flex-col sm:flex-row w-full"},Pe={class:"flex gap-2 flex-col-reverse items-stretch justify-end w-full sm:flex-row sm:items-center"},je=E({__name:"EditGuideForm",props:{guide:{type:Object,default:null},saveButtonLabel:{type:String,default:"Save"}},emits:["close","save"],setup(V,{expose:g,emit:k}){const{uploadImages:c}=le(),n=V,i={id:-1,name:"",coverImage:"",images:[],height:0,weight:0,birthYear:0,language:[],feature:[],hobby:[],sortOrder:0,isActive:!0,createdAt:"",updatedAt:"",deletedAt:null,coverImageUrl:"",imageUrls:[]},e=w({...i}),$=ee(()=>Object.keys(e.value).some(l=>{var o;return l==="avatar"||l==="images"?!1:e.value[l]!==((o=n.guide??i)==null?void 0:o[l])}));g({isFormHasUnsavedChanges:$});const u=w([]),d=w([]),C=w([]);L(()=>n.guide,()=>{n.guide&&(e.value={...n.guide},u.value=n.guide.language||[],d.value=n.guide.feature||[],C.value=n.guide.hobby||[])},{immediate:!0});const m=l=>{u.value.includes(l)||u.value.push(l)},v=l=>{d.value.includes(l)||d.value.push(l)},I=l=>{C.value.includes(l)||C.value.push(l)},_=w(),x=w([]),N=l=>URL.createObjectURL(l),a=l=>URL.createObjectURL(l),b=l=>{e.value.imageUrls&&e.value.imageUrls.splice(l,1),e.value.images&&e.value.images.splice(l,1)};L(_,l=>{e.value.coverImageUrl=l?N(l):""});const T=me("add-guide-form"),P=k,R=async()=>{if(T.validate()){if(!_.value&&!e.value.coverImage){H().init({message:"請上傳大頭照",position:"top-right",color:"danger"});return}if(x.value.length===0&&e.value.images.length===0){H().init({message:"請至少上傳一張相片",position:"top-right",color:"danger"});return}if(_.value&&await c([_.value]).then(l=>{e.value.coverImage=l[0]}),x.value.length>0&&await c(x.value).then(l=>{e.value.images||(e.value.images=[]),e.value.images.push(...l)}),n.guide){const l={id:n.guide.id,name:e.value.name,coverImage:e.value.coverImage,images:e.value.images,height:e.value.height?Number(e.value.height):0,weight:e.value.weight?Number(e.value.weight):0,birthYear:e.value.birthYear?Number(e.value.birthYear):0,language:e.value.language,feature:e.value.feature,hobby:e.value.hobby,sortOrder:Number(e.value.sortOrder)||0,isActive:e.value.isActive};P("save",l)}else{const l={name:e.value.name,coverImage:e.value.coverImage,images:e.value.images,height:e.value.height?Number(e.value.height):0,weight:e.value.weight?Number(e.value.weight):0,birthYear:e.value.birthYear?Number(e.value.birthYear):0,language:e.value.language,feature:e.value.feature,hobby:e.value.hobby,sortOrder:Number(e.value.sortOrder)||0,isActive:e.value.isActive};P("save",l)}}};return(l,o)=>{const A=p("VaButton"),j=p("VaFileUpload"),f=p("VaInput"),S=p("VaSelect"),M=p("VaCheckbox"),te=p("VaForm");return U(),Y(te,{ref:"add-guide-form",class:"flex-col justify-start items-start gap-4 inline-flex w-full"},{default:y(({isValid:oe})=>{var W;return[t(j,{modelValue:_.value,"onUpdate:modelValue":o[1]||(o[1]=s=>_.value=s),type:"single","hide-file-list":"",class:"self-stretch justify-start items-center gap-4 inline-flex"},{default:y(()=>[t(ae,{guide:e.value,size:"large"},null,8,["guide"]),t(A,{preset:"primary",size:"small"},{default:y(()=>[G("Add image")]),_:1}),_.value?(U(),Y(A,{key:0,preset:"primary",color:"danger",size:"small",icon:"delete",class:"z-10",onClick:o[0]||(o[0]=de(s=>_.value=void 0,["stop"]))})):q("",!0)]),_:1},8,["modelValue"]),r("div",xe,[r("div",$e,[t(f,{modelValue:e.value.name,"onUpdate:modelValue":o[2]||(o[2]=s=>e.value.name=s),label:"名稱",class:"w-full sm:w-1/2",rules:[h(Q).required],name:"name"},null,8,["modelValue","rules"])]),r("div",Ce,[t(f,{modelValue:e.value.height,"onUpdate:modelValue":o[3]||(o[3]=s=>e.value.height=s),label:"身高 (cm)",class:"w-full sm:w-1/2",name:"height",type:"number"},null,8,["modelValue"]),t(f,{modelValue:e.value.weight,"onUpdate:modelValue":o[4]||(o[4]=s=>e.value.weight=s),label:"體重 (kg)",class:"w-full sm:w-1/2",name:"weight",type:"number"},null,8,["modelValue"])]),r("div",Ue,[t(f,{modelValue:e.value.birthYear,"onUpdate:modelValue":o[5]||(o[5]=s=>e.value.birthYear=s),label:"出生年份",class:"w-full sm:w-1/2",name:"birthYear",type:"number"},null,8,["modelValue"])]),r("div",ke,[t(S,{modelValue:e.value.language,"onUpdate:modelValue":o[6]||(o[6]=s=>e.value.language=s),label:"語言能力",class:"w-full sm:w-1/2",name:"language",multiple:"",options:u.value,"allow-create":"unique",onCreateNew:m},null,8,["modelValue","options"]),t(S,{modelValue:e.value.feature,"onUpdate:modelValue":o[7]||(o[7]=s=>e.value.feature=s),label:"服務特色",class:"w-full sm:w-1/2",name:"feature",multiple:"",options:d.value,"allow-create":"unique",onCreateNew:v},null,8,["modelValue","options"])]),r("div",Ae,[t(S,{modelValue:e.value.hobby,"onUpdate:modelValue":o[8]||(o[8]=s=>e.value.hobby=s),label:"興趣",class:"w-full sm:w-1/2",name:"hobby",multiple:"",options:C.value,"allow-create":"unique",onCreateNew:I},null,8,["modelValue","options"])]),r("div",Ie,[Oe,t(j,{modelValue:x.value,"onUpdate:modelValue":o[9]||(o[9]=s=>x.value=s),type:"gallery","file-types":"image/*",class:"w-full","hide-file-list":""},{default:y(()=>[t(A,{preset:"primary",size:"small"},{default:y(()=>[G("上傳相片")]),_:1})]),_:1},8,["modelValue"]),((W=e.value.imageUrls)==null?void 0:W.length)>0||x.value.length>0?(U(),O("div",Be,[(U(!0),O(D,null,J(e.value.imageUrls,(s,B)=>(U(),O("div",{key:`existing-${B}`,class:"relative w-20 h-20 border border-gray-300 rounded overflow-hidden"},[r("img",{src:s,alt:`Existing Photo ${B+1}`,class:"w-full h-full object-cover"},null,8,Ge),t(A,{preset:"primary",color:"danger",size:"small",icon:"delete",class:"absolute top-1 right-1 w-6 h-6 min-w-0 p-0",onClick:se=>b(B)},null,8,["onClick"])]))),128)),(U(!0),O(D,null,J(x.value,(s,B)=>(U(),O("div",{key:`new-${B}`,class:"relative w-20 h-20 border border-gray-300 rounded overflow-hidden"},[r("img",{src:a(s),alt:`New Photo ${B+1}`,class:"w-full h-full object-cover"},null,8,Fe),t(A,{preset:"primary",color:"danger",size:"small",icon:"delete",class:"absolute top-1 right-1 w-6 h-6 min-w-0 p-0",onClick:se=>x.value.splice(B,1)},null,8,["onClick"])]))),128))])):q("",!0)]),r("div",Ne,[r("div",Se,[t(M,{modelValue:e.value.isActive,"onUpdate:modelValue":o[10]||(o[10]=s=>e.value.isActive=s),label:"Active",class:"w-full",name:"active"},null,8,["modelValue"])])]),r("div",ze,[t(f,{modelValue:e.value.sortOrder,"onUpdate:modelValue":o[11]||(o[11]=s=>e.value.sortOrder=s),label:"Sort Order",class:"w-full sm:w-1/2",rules:[h(Q).required],name:"sortOrder",type:"number"},null,8,["modelValue","rules"])]),r("div",Pe,[t(A,{preset:"secondary",color:"secondary",onClick:o[12]||(o[12]=s=>l.$emit("close"))},{default:y(()=>[G("Cancel")]),_:1}),t(A,{disabled:!oe,onClick:R},{default:y(()=>[G(F(V.saveButtonLabel),1)]),_:2},1032,["disabled"])])])]}),_:1},512)}}}),De=r("h1",{class:"page-title"},"奧黛導遊",-1),Ee={class:"flex flex-col md:flex-row gap-2 mb-2 justify-between"},Te={class:"flex flex-col md:flex-row gap-2 justify-start"},Re={class:"va-h5"},Je=E({__name:"GuidesPage",setup(V){const g=w(!1),{guides:k,isLoading:c,filters:n,sorting:i,pagination:e,...$}=le(),u=w(null),d=a=>{u.value=a,g.value=!0},C=()=>{u.value=null,g.value=!0},{init:m}=H(),v=async a=>{try{"id"in a?(await $.update(a),m({message:`${a.name} has been updated`,color:"success"})):(await $.add(a),m({message:`${a.name} has been created`,color:"success"}))}catch{m({message:"Operation failed. Please try again.",color:"danger"})}},I=async a=>{await $.remove(a),m({message:`${a.name} has been deleted`,color:"success"})},_=w(),{confirm:x}=X(),N=async a=>{_.value.isFormHasUnsavedChanges?await x({maxWidth:"380px",message:"Form has unsaved changes. Are you sure you want to close it?",size:"small"})&&a():a()};return(a,b)=>{const T=p("VaButtonToggle"),P=p("VaIcon"),R=p("VaInput"),l=p("VaButton"),o=p("VaCardContent"),A=p("VaCard"),j=p("VaModal");return U(),O(D,null,[De,t(A,null,{default:y(()=>[t(o,null,{default:y(()=>[r("div",Ee,[r("div",Te,[t(T,{modelValue:h(n).isActive,"onUpdate:modelValue":b[0]||(b[0]=f=>h(n).isActive=f),color:"background-element","border-color":"background-element",options:[{label:"Active",value:!0},{label:"Inactive",value:!1}]},null,8,["modelValue"]),t(R,{modelValue:h(n).search,"onUpdate:modelValue":b[1]||(b[1]=f=>h(n).search=f),placeholder:"Search"},{prependInner:y(()=>[t(P,{name:"search",color:"secondary",size:"small"})]),_:1},8,["modelValue"])]),t(l,{onClick:C},{default:y(()=>[G("Add Guide")]),_:1})]),t(ye,{"sort-by":h(i).sortBy,"onUpdate:sortBy":b[2]||(b[2]=f=>h(i).sortBy=f),"sorting-order":h(i).sortingOrder,"onUpdate:sortingOrder":b[3]||(b[3]=f=>h(i).sortingOrder=f),guides:h(k),loading:h(c),pagination:h(e),onEditGuide:d,onDeleteGuide:I},null,8,["sort-by","sorting-order","guides","loading","pagination"])]),_:1})]),_:1}),t(j,{modelValue:g.value,"onUpdate:modelValue":b[4]||(b[4]=f=>g.value=f),size:"small","mobile-fullscreen":"","close-button":"","hide-default-actions":"","before-cancel":N},{default:y(({cancel:f,ok:S})=>[r("h1",Re,F(u.value?"Edit guide":"Add guide"),1),t(je,{ref_key:"editFormRef",ref:_,guide:u.value,"save-button-label":u.value?"Save":"Add",onClose:f,onSave:M=>{v(M),S()}},null,8,["guide","save-button-label","onClose","onSave"])]),_:1},8,["modelValue"])],64)}}});export{Je as default};
//# sourceMappingURL=GuidesPage-7e7f403f.js.map
